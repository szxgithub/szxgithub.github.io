<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ¶‚å±±æ¹–ç•”</title>
  <icon>https://blog.k8s.li/icon.png</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://blog.k8s.li/"/>
  <updated>2022-02-27T16:00:00.000Z</updated>
  <id>https://blog.k8s.li/</id>
  
  <author>
    <name>koi</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ä½¿ç”¨ kubectl è‡ªåŠ¨å½’æ¡£ argo workflow æ—¥å¿—</title>
    <link href="https://blog.k8s.li/2022-02-28-archive-argo-workflow-log-by-kubectl.html"/>
    <id>https://blog.k8s.li/2022-02-28-archive-argo-workflow-log-by-kubectl.html</id>
    <published>2022-02-27T16:00:00.000Z</published>
    <updated>2022-02-27T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>é¡¹ç›®ä¸Šä½¿ç”¨åˆ° <a href="https://github.com/argoproj/argo-workflows">argo-workflow</a> ä½œä¸ºå·¥ä½œæµå¼•æ“æ¥ç¼–æ’è¿è¡Œä¸€äº› <a href="https://www.smartx.com/solution/virtualization/">è¶…èåˆ</a> é›†ç¾¤éƒ¨ç½²ç›¸å…³çš„ä»»åŠ¡ï¼Œæ•´å¥—ç¯å¢ƒè¿è¡Œåœ¨ä¸€ä¸ªå•èŠ‚ç‚¹çš„ K3s ä¸Šã€‚ä¹‹æ‰€ä»¥é€‰æ‹© argo-workflow + K3s çš„æ­é…ä¸»è¦æ˜¯æƒ³å°½å¯èƒ½å°‘åœ°å ç”¨ç³»ç»Ÿèµ„æºï¼Œå› ä¸ºè¿™å¥—ç¯å¢ƒå°†æ¥ä¼šè¿è¡Œåœ¨å„ç§ç¡¬ä»¶é…ç½®ä¸åŒçš„ç¬”è®°æœ¬ç”µè„‘ä¸Š ğŸ˜‚ã€‚ç»¼åˆè°ƒç ”äº†ä¸€äº›å¸¸è§çš„ K8s éƒ¨ç½²å·¥å…·æœ€ç»ˆå°±é€‰æ‹©äº†ç³»ç»Ÿèµ„æºå ç”¨è¾ƒå°‘çš„ K3sã€‚</p><p>ç°åœ¨é¡¹ç›®çš„ä¸€ä¸ªéœ€æ±‚å°±æ˜¯åœ¨é›†ç¾¤éƒ¨ç½²å®Œæˆæˆ–å¤±è´¥ä¹‹åéœ€è¦å°† workflow çš„æ—¥å¿—å½’æ¡£ä¿å­˜ä¸‹æ¥ã€‚è™½ç„¶å¯ä»¥åœ¨ workflow çš„ spec å­—æ®µä¸­ä½¿ç”¨ <code>archiveLogs: true</code> æ¥è®© argo å¸®æˆ‘ä»¬è‡ªåŠ¨å½’æ¡£æ—¥å¿—ï¼Œä½†è¿™ä¸ªç‰¹æ€§ä¾èµ–äºä¸€ä¸ª S3 å¯¹è±¡å­˜å‚¨ <a href="https://argoproj.github.io/argo-workflows/configure-artifact-repository/">Artifact Repository</a> ã€‚è¿™å°±æ„å‘³ç€è¿˜è¦å†éƒ¨ç½²ä¸€ä¸ªæ”¯æŒ S3 å¯¹è±¡å­˜å‚¨çš„ç»„ä»¶æ¯”å¦‚ <a href="https://min.io/">Minio</a> ï¼Œç›´æ¥æŠŠæˆ‘ç»™æ•´ä¸ä¼šäº† ğŸŒš</p><p><img src="https://p.k8s.li/2021-08-31-pass-tob-k8s-offline-deploy-2.jpeg"></p><p>å…¶å®å˜›è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•çš„ï¼Œæˆ‘å°±æƒ³ä¿å­˜ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶è€Œå·²ï¼Œä½ è¿˜å†è®©æˆ‘å®‰è£…ä¸€ä¸ª <a href="https://min.io/">Minio</a>ï¼Œå®åœ¨æ˜¯å¤ªè¿‡åˆ†äº†ï¼æœ¬æ¥ç³»ç»Ÿçš„èµ„æºååˆ†æœ‰é™ï¼Œéœ€è¦å°½å¯èƒ½å‡å°‘å®‰è£…ä¸€äº›ä¸å¿…è¦ä¾èµ–ï¼Œä¸ºçš„å°±æ˜¯å°†èµ„æºåˆ©ç”¨ç‡å°†åˆ°æœ€ä½ã€‚ä½†ç°åœ¨ä¸ºäº†å½’æ¡£å­˜å‚¨ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶å‚¨è€Œå¤§åŠ¨å¹²æˆˆè£…ä¸€ä¸ª minio å®åœ¨æ˜¯ä¸åˆ’ç®—ã€‚è¿™å°±å¥½æ¯”ä½ è´¹äº†å¥½å¤§åŠŸå¤«éƒ¨ç½²ä¸€å¥— 3 èŠ‚ç‚¹çš„ kubernetes é›†ç¾¤ï¼Œç„¶è€Œå°±ä¸ºäº†è¿è¡Œä¸€ä¸ªé™æ€åšå®¢é‚£æ ·æ»‘ç¨½ ğŸ˜‚</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">Deployed my blog on Kubernetes <a href="https://t.co/XHXWLrmYO4">pic.twitter.com/XHXWLrmYO4</a></p>&mdash; For DevOps Eyes Only (@dexhorthy) <a href="https://twitter.com/dexhorthy/status/856639005462417409?ref_src=twsrc%5Etfw">April 24, 2017</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>å¯¹äºå’±è¿™ç§ <code>ç”¨ä¸èµ·</code> S3 å¯¹è±¡å­˜å‚¨çš„ç©·äººå®¶å­©å­ï¼Œè¿˜æ˜¯æƒ³ä¸€äº›å…¶ä»–åŠæ³•å§ï¼Œæ¯•ç«Ÿè‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿã€‚</p><h2 id="kubectl"><a href="#kubectl" class="headerlink" title="kubectl"></a>kubectl</h2><p>å®ç°èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¯¹äºå’±è¿™ç§ YAML å·¥ç¨‹å¸ˆæ¥è¯´ï¼Œkubectl è‡ªç„¶å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚æƒ³è¦è·å– workflow çš„æ—¥å¿—ï¼Œåªéœ€è¦é€šè¿‡ kubectl logs å‘½ä»¤è·å–å‡º workflow æ‰€åˆ›çš„ pod æ—¥å¿—å°±è¡Œäº†å‘€ï¼Œè¦ä»€ä¹ˆ S3 å¯¹è±¡å­˜å‚¨ ğŸ˜–</p><h3 id="ç­›é€‰-pod"><a href="#ç­›é€‰-pod" class="headerlink" title="ç­›é€‰ pod"></a>ç­›é€‰ pod</h3><p>å¯¹äºåŒä¸€ä¸ª workflow æ¥å°†ï¼Œæ¯ä¸ª stage æ‰€åˆ›å»ºå‡ºæ¥çš„ pod name æœ‰ä¸€å®šçš„è§„å¾‹ã€‚åœ¨å®šä¹‰ workflow çš„æ—¶å€™ï¼Œ<a href="https://argoproj.github.io/argo-workflows/fields/#objectmeta">generateName</a> å‚æ•°é€šå¸¸ä½¿ç”¨ <code>$&#123;name&#125;-</code> æ ¼å¼ã€‚ä»¥ <code>-</code> ä½œä¸ºåˆ†éš”ç¬¦ï¼Œæœ€åä¸€ä¸ªå­—æ®µæ˜¯éšæœºç”Ÿæˆçš„ä¸€ä¸ªæ•°å­— IDï¼Œå€’æ•°ç¬¬äºŒä¸ªå­—æ®µåˆ™æ˜¯ argo éšæœºç”Ÿæˆçš„ workflow IDï¼Œå‰©ä½™å‰é¢çš„å­—ç¬¦åˆ™æ˜¯æˆ‘ä»¬å®šä¹‰çš„ generateNameã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Workflow<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">generateName</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">archive-log-test-jzt8n-3498199655                          <span class="token number">0</span>/2     Completed   <span class="token number">0</span>               4m18sarchive-log-test-jzt8n-3618624526                          <span class="token number">0</span>/2     Completed   <span class="token number">0</span>               4m8sarchive-log-test-jzt8n-2123203324                          <span class="token number">0</span>/2     Completed   <span class="token number">0</span>               3m58s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>åœ¨ pod çš„ labels ä¸­åŒæ ·ä¹ŸåŒ…å«ç€è¯¥ workflow æ‰€å¯¹åº”çš„ IDï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®æ­¤ labels è¿‡æ»¤å‡ºè¯¥ workflow æ‰€åˆ›å»ºå‡ºæ¥çš„ podã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>    <span class="token key atrule">workflows.argoproj.io/node-id</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>jzt8n<span class="token punctuation">-</span><span class="token number">3498199655</span>    <span class="token key atrule">workflows.argoproj.io/node-name</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>jzt8n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.list<span class="token punctuation">-</span>default<span class="token punctuation">-</span>running<span class="token punctuation">-</span>pods  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">"2022-02-28T12:53:32Z"</span>  <span class="token key atrule">labels</span><span class="token punctuation">:</span>    <span class="token key atrule">workflows.argoproj.io/completed</span><span class="token punctuation">:</span> <span class="token string">"true"</span>    <span class="token key atrule">workflows.argoproj.io/workflow</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>jzt8n  <span class="token key atrule">name</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>jzt8n<span class="token punctuation">-</span><span class="token number">3498199655</span>  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default  <span class="token key atrule">ownerReferences</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1    <span class="token key atrule">blockOwnerDeletion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">controller</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token key atrule">kind</span><span class="token punctuation">:</span> Workflow    <span class="token key atrule">name</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>jzt8n    <span class="token key atrule">uid</span><span class="token punctuation">:</span> e91df2cb<span class="token punctuation">-</span>b567<span class="token punctuation">-</span>4cf0<span class="token punctuation">-</span>9be5<span class="token punctuation">-</span>3dd6c72854cd  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">"1251330"</span>  <span class="token key atrule">uid</span><span class="token punctuation">:</span> ce37a709<span class="token punctuation">-</span>8236<span class="token punctuation">-</span>445b<span class="token punctuation">-</span>8d00<span class="token punctuation">-</span>a7926fa18ed0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>-l lables</code> è¿‡æ»¤å‡ºä¸€ä¸ª workflow æ‰€åˆ›å»ºçš„ podï¼›é€šè¿‡ <code>--sort-by</code> ä»¥åˆ›å»ºæ—¶é—´è¿›è¡Œæ’åºï¼›é€šè¿‡ <code>-o name</code> åªè¾“å‡º pod çš„ nameï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl get pods -l workflows.argoproj.io/workflow<span class="token operator">=</span>archive-log-test-jzt8n --sort-by<span class="token operator">=</span><span class="token string">'.metadata.creationTimestamp'</span> -o namepod/archive-log-test-jzt8n-3498199655pod/archive-log-test-jzt8n-3618624526pod/archive-log-test-jzt8n-2123203324<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–æ—¥å¿—"><a href="#è·å–æ—¥å¿—" class="headerlink" title="è·å–æ—¥å¿—"></a>è·å–æ—¥å¿—</h3><p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤æˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°ä¸€ä¸ª workflow æ‰€åˆ›å»ºçš„ pod åˆ—è¡¨ã€‚ç„¶åå†é€šè¿‡ kubectl logs å‘½ä»¤è·å– pod ä¸­ main å®¹å™¨çš„æ—¥å¿—ï¼Œä¸ºæ–¹ä¾¿åŒºåˆ†æ—¥å¿—çš„æ‰€å¯¹åº”çš„ workflow ï¼Œæˆ‘ä»¬å°±ä»¥ workflow çš„ ID ä¸ºå‰ç¼€åã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl logs archive-log-test-jzt8n-3618624526 -c main<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">LOG_PATH</span><span class="token operator">=</span>/var/log<span class="token assign-left variable">NAME</span><span class="token operator">=</span>archive-log-test-jzt8nkubectl get pods -l workflows.argoproj.io/workflow<span class="token operator">=</span><span class="token variable">$&#123;NAME&#125;</span> <span class="token punctuation">\</span>--sort-by<span class="token operator">=</span><span class="token string">'.metadata.creationTimestamp'</span> -o name <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> -t kubectl logs <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> -c main <span class="token operator">>></span> <span class="token variable">$&#123;LOG_PATH&#125;</span>/<span class="token variable">$&#123;NAME&#125;</span>.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="workflow"><a href="#workflow" class="headerlink" title="workflow"></a>workflow</h3><p>æ ¹æ® argo-workflow å®˜æ–¹æä¾›çš„ <a href="https://github.com/argoproj/argo-workflows/blob/master/examples/exit-handlers.yaml"><strong>exit-handlers.yaml</strong></a> exampleï¼Œæˆ‘ä»¬å°±ç…§è‘«èŠ¦ç”»ç“¢æ“ä¸€ä¸ª workflow é€€å‡ºåè‡ªåŠ¨è°ƒç”¨ä½¿ç”¨ kubectl è·å– workflow æ—¥å¿—çš„ä¸€ä¸ª stepï¼Œå®šä¹‰çš„ exit-handler å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> exit<span class="token punctuation">-</span>handler    <span class="token key atrule">container</span><span class="token punctuation">:</span>      <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"kubectl"</span>      <span class="token key atrule">image</span><span class="token punctuation">:</span> lachlanevenson/k8s<span class="token punctuation">-</span>kubectl<span class="token punctuation">:</span>v1.23.2      <span class="token key atrule">command</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> sh        <span class="token punctuation">-</span> <span class="token punctuation">-</span>c        <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">          kubectl get pods -l workflows.argoproj.io/workflow=$&#123;POD_NAME%-*&#125; \          --sort-by=".metadata.creationTimestamp" -o name | grep -v $&#123;POD_NAME&#125; \          | xargs -I &#123;&#125; -t kubectl logs &#123;&#125; -c main >> $&#123;LOG_PATH&#125;/$&#123;POD_NAME%-*&#125;.log</span>      <span class="token key atrule">env</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> LOG_PATH          <span class="token key atrule">value</span><span class="token punctuation">:</span> /var/log/workflow      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>datastore          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/workflow    <span class="token key atrule">retryStrategy</span><span class="token punctuation">:</span>      <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token string">"5"</span>      <span class="token key atrule">retryPolicy</span><span class="token punctuation">:</span> OnFailure<span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> default<span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>datastore    <span class="token key atrule">nfs</span><span class="token punctuation">:</span>      <span class="token key atrule">server</span><span class="token punctuation">:</span> NFS_SERVER      <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/workflow/log<span class="token key atrule">onExit</span><span class="token punctuation">:</span> exit<span class="token punctuation">-</span>handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†ä¸Šè¿°å®šä¹‰çš„ <code>exit-handler</code> å†…å®¹å¤åˆ¶ç²˜è´´åˆ°ä½ çš„ workflow spec é…ç½®ä¸­å°±å¯ä»¥ã€‚ç”±äºæ—¥å¿—éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ NFS å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æ¢æˆå…¶ä»–å­˜å‚¨ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€ä¸‹ <code>volumes</code> é…ç½®å³å¯ã€‚</p><p>å®Œæ•´çš„ <a href="https://gist.github.com/muzi502/9b26c6854c509c42ecd7f7004436ca23">workflow example</a> å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> argoproj.io/v1alpha1<span class="token key atrule">kind</span><span class="token punctuation">:</span> Workflow<span class="token key atrule">metadata</span><span class="token punctuation">:</span>  <span class="token key atrule">generateName</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test<span class="token punctuation">-</span>  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default<span class="token key atrule">spec</span><span class="token punctuation">:</span>  <span class="token key atrule">templates</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test      <span class="token key atrule">steps</span><span class="token punctuation">:</span>        <span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> list<span class="token punctuation">-</span>default<span class="token punctuation">-</span>running<span class="token punctuation">-</span>pods            <span class="token key atrule">template</span><span class="token punctuation">:</span> kubectl            <span class="token key atrule">arguments</span><span class="token punctuation">:</span>              <span class="token key atrule">parameters</span><span class="token punctuation">:</span>                <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> namespace                  <span class="token key atrule">value</span><span class="token punctuation">:</span> default        <span class="token punctuation">-</span> <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> list<span class="token punctuation">-</span>kube<span class="token punctuation">-</span>system<span class="token punctuation">-</span>running<span class="token punctuation">-</span>pods            <span class="token key atrule">template</span><span class="token punctuation">:</span> kubectl            <span class="token key atrule">arguments</span><span class="token punctuation">:</span>              <span class="token key atrule">parameters</span><span class="token punctuation">:</span>                <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> namespace                  <span class="token key atrule">value</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubectl      <span class="token key atrule">inputs</span><span class="token punctuation">:</span>        <span class="token key atrule">parameters</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> namespace      <span class="token key atrule">container</span><span class="token punctuation">:</span>        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"kubectl"</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> lachlanevenson/k8s<span class="token punctuation">-</span>kubectl<span class="token punctuation">:</span>v1.23.2        <span class="token key atrule">command</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> sh          <span class="token punctuation">-</span> <span class="token punctuation">-</span>c          <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">            kubectl get pods --field-selector=status.phase=Running -n &#123;&#123;inputs.parameters.namespace&#125;&#125;</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> exit<span class="token punctuation">-</span>handler      <span class="token key atrule">container</span><span class="token punctuation">:</span>        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"kubectl"</span>        <span class="token key atrule">image</span><span class="token punctuation">:</span> lachlanevenson/k8s<span class="token punctuation">-</span>kubectl<span class="token punctuation">:</span>v1.23.2        <span class="token key atrule">command</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> sh          <span class="token punctuation">-</span> <span class="token punctuation">-</span>c          <span class="token punctuation">-</span> <span class="token punctuation">|</span><span class="token scalar string">            kubectl get pods -l workflows.argoproj.io/workflow=$&#123;POD_NAME%-*&#125; \            --sort-by=".metadata.creationTimestamp" -o name | grep -v $&#123;POD_NAME&#125; \            | xargs -I &#123;&#125; -t kubectl logs &#123;&#125; -c main >> $&#123;LOG_PATH&#125;/$&#123;POD_NAME%-*&#125;.log</span>        <span class="token key atrule">env</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME            <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>              <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>                <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> LOG_PATH            <span class="token key atrule">value</span><span class="token punctuation">:</span> /var/log/workflow        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>          <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>datastore            <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/workflow      <span class="token key atrule">retryStrategy</span><span class="token punctuation">:</span>        <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token string">"5"</span>        <span class="token key atrule">retryPolicy</span><span class="token punctuation">:</span> OnFailure  <span class="token key atrule">entrypoint</span><span class="token punctuation">:</span> archive<span class="token punctuation">-</span>log<span class="token punctuation">-</span>test  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> default  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>datastore      <span class="token key atrule">nfs</span><span class="token punctuation">:</span>        <span class="token key atrule">server</span><span class="token punctuation">:</span> NFS_SERVER        <span class="token key atrule">path</span><span class="token punctuation">:</span> /data/workflow/log  <span class="token key atrule">onExit</span><span class="token punctuation">:</span> exit<span class="token punctuation">-</span>handler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;é¡¹ç›®ä¸Šä½¿ç”¨åˆ° &lt;a
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="kubectl" scheme="https://blog.k8s.li/tags/kubectl/"/>
    
      <category term="argo-workflow" scheme="https://blog.k8s.li/tags/argo-workflow/"/>
    
  </entry>
  
  <entry>
    <title>VMware Tanzu kubernetes å‘è¡Œç‰ˆéƒ¨ç½²å°é²œ</title>
    <link href="https://blog.k8s.li/2022-02-06-deploy-tanzu-k8s-cluster.html"/>
    <id>https://blog.k8s.li/2022-02-06-deploy-tanzu-k8s-cluster.html</id>
    <published>2022-02-05T16:00:00.000Z</published>
    <updated>2022-02-05T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰æ¥è§¦çš„ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·å¤§å¤šæ•°éƒ½æ˜¯ä¾èµ–äº ssh è¿æ¥åˆ°å¾…éƒ¨ç½²çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œéƒ¨ç½²æ“ä½œï¼Œè¿™æ ·å°±è¦æ±‚éƒ¨ç½²å‰éœ€è¦æå‰å‡†å¤‡å¥½é›†ç¾¤èŠ‚ç‚¹ï¼Œä¸”è¦ä¿è¯è¿™äº›èŠ‚ç‚¹çš„ç½‘ç»œäº’é€šä»¥åŠæ—¶é’ŸåŒæ­¥ç­‰é—®é¢˜ã€‚ç±»ä¼¼äº kubespray æˆ–è€… kubekey è¿™äº›éƒ¨ç½²å·¥å…·æ˜¯ä¸ä¼šå»ç®¡è¿™äº›åº•å±‚çš„ IaaS èµ„æºçš„åˆ›å»ºï¼Œæ˜¯è¦è‡ªå·±æå‰å‡†å¤‡å¥½ã€‚ä½†æ˜¯åœ¨ä¸€äº›ä¼ä¸šç§æœ‰äº‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨äº†å¦‚ <a href="https://docs.vmware.com/cn/VMware-vSphere/index.html">VMware vShpere</a> æˆ– <a href="https://www.openstack.org/">OpenStack</a> è¿™äº›è™šæ‹ŸåŒ–å¹³å°ï¼Œæ˜¯å¯ä»¥å°† K8s é›†ç¾¤éƒ¨ç½²ä¸ IaaS èµ„æºåˆ›å»ºè¿™ä¸¤æ­¥ç»Ÿä¸€èµ·æ¥çš„ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ‰‹åŠ¨åˆ›å»ºå’Œé…ç½®è™šæ‹Ÿæœºè¿™äº›ç¹ççš„æ­¥éª¤ã€‚</p><p>ç›®å‰å°† IaaS èµ„æºåˆ›å»ºä¸ K8s é›†ç¾¤éƒ¨ç½²ç»“åˆèµ·æ¥ä¹Ÿæœ‰æ¯”è¾ƒæˆç†Ÿçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚åŸºäº <a href="https://github.com/kubernetes-sigs/cluster-api">cluster-api</a> é¡¹ç›®çš„ <a href="https://github.com/vmware-tanzu">tanzu</a> ã€‚æœ¬æ–‡å°±ä»¥ <a href="https://github.com/vmware-tanzu/community-edition">VMware Tanzu ç¤¾åŒºç‰ˆ</a> ä¸ºä¾‹åœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œä»å®‰è£… ESXi OS åˆ°éƒ¨ç½²å®Œæˆ Tanzu Workload é›†ç¾¤ï¼Œæ¥ä½“éªŒä¸€ä¸‹è¿™ç§éƒ¨ç½²æ–¹æ¡ˆçš„ä¸ä¼—ä¸åŒä¹‹å¤„ã€‚</p><h2 id="éƒ¨ç½²æµç¨‹"><a href="#éƒ¨ç½²æµç¨‹" class="headerlink" title="éƒ¨ç½²æµç¨‹"></a>éƒ¨ç½²æµç¨‹</h2><ul><li>ä¸‹è½½ä¾èµ–æ–‡ä»¶</li><li>å®‰è£… govc ä¾èµ–</li><li>å®‰è£… ESXi OS</li><li>å®‰è£… vCenter</li><li>é…ç½® vCenter</li><li>åˆ›å»º bootstrap è™šæ‹Ÿæœº</li><li>åˆå§‹åŒ– bootstrap èŠ‚ç‚¹</li><li>éƒ¨ç½² Tanzu Manager é›†ç¾¤</li><li>éƒ¨ç½² Tanzu Workload é›†ç¾¤</li></ul><h3 id="åŠé€€ä¸‰è¿-ğŸ˜‚"><a href="#åŠé€€ä¸‰è¿-ğŸ˜‚" class="headerlink" title="åŠé€€ä¸‰è¿ ğŸ˜‚"></a>åŠé€€ä¸‰è¿ ğŸ˜‚</h3><ul><li>éœ€è¦æœ‰ä¸€ä¸ª <a href="https://customerconnect.vmware.com/login">VMware çš„è´¦æˆ·</a> ç”¨äºä¸‹è½½ä¸€äº› ISO é•œåƒå’Œè™šæ‹Ÿæœºæ¨¡ç‰ˆ;</li><li>éœ€è¦æœ‰ä¸€å°ç‰©ç†æœåŠ¡å™¨ï¼Œæ¨èæœ€ä½é…ç½® 8C 32Gï¼Œè‡³å°‘ 256GB å­˜å‚¨ï¼›</li><li>éœ€è¦ä¸€å° DHCP æœåŠ¡å™¨ï¼Œç”±äºé»˜è®¤æ˜¯ä½¿ç”¨ DHCP è·å– IP æ¥åˆ†é…ç»™è™šæ‹Ÿæœºçš„ï¼Œå› æ­¤ ESXi æ‰€åœ¨çš„ VM Network  ç½‘ç»œä¸­å¿…é¡»æœ‰ä¸€å° DHCP æœåŠ¡å™¨ç”¨äºç»™è™šæ‹Ÿæœºåˆ†é… IPï¼›</li></ul><h3 id="ä¸‹è½½ä¾èµ–æ–‡ä»¶"><a href="#ä¸‹è½½ä¾èµ–æ–‡ä»¶" class="headerlink" title="ä¸‹è½½ä¾èµ–æ–‡ä»¶"></a>ä¸‹è½½ä¾èµ–æ–‡ä»¶</h3><p>æ•´ä¸ªéƒ¨ç½²æµç¨‹æ‰€éœ€è¦çš„ä¾æ–‡ä»¶èµ–å¦‚ä¸‹ï¼Œå¯ä»¥å…ˆå°†è¿™äº›ä¾èµ–ä¸‹è½½åˆ°æœ¬åœ°çš„æœºå™¨ä¸Šï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@devbox:/root/tanzu <span class="token comment"># tree -sh</span><span class="token builtin class-name">.</span>â”œâ”€â”€ <span class="token punctuation">[</span>  12M<span class="token punctuation">]</span>  govc_Linux_x86_64.tar.gzâ”œâ”€â”€ <span class="token punctuation">[</span> 895M<span class="token punctuation">]</span>  photon-3-kube-v1.21.2+vmware.1-tkg.2-12816990095845873721.ovaâ”œâ”€â”€ <span class="token punctuation">[</span> 225M<span class="token punctuation">]</span>  photon-ova-4.0-c001795b80.ovaâ”œâ”€â”€ <span class="token punctuation">[</span> 170M<span class="token punctuation">]</span>  tce-linux-amd64-v0.9.1.tar.gzâ”œâ”€â”€ <span class="token punctuation">[</span> <span class="token number">9</span>.0G<span class="token punctuation">]</span>  VMware-VCSA-all-7.0.3-18778458.isoâ””â”€â”€ <span class="token punctuation">[</span> 390M<span class="token punctuation">]</span>  VMware-VMvisor-Installer-7.0U2a-17867351.x86_64.iso<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>æ–‡ä»¶</th><th>ç”¨é€”</th><th>ä¸‹è½½æ–¹å¼</th></tr></thead><tbody><tr><td><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=ESXI70U2A&productId=974&rPId=46384">VMware-VMvisor-Installer-7.0U2a-17867351.x86_64.iso</a></td><td>å®‰è£… ESXi OS</td><td>VMware éœ€è´¦æˆ·</td></tr><tr><td><a href="https://customerconnect.vmware.com/downloads/details?downloadGroup=VC70U3C&productId=974&rPId=83853">VMware-VCSA-all-7.0.3-19234570.iso</a></td><td>å®‰è£… vCenter</td><td>VMware éœ€è´¦æˆ·</td></tr><tr><td><a href="https://packages.vmware.com/photon/4.0/Rev2/ova/photon-ova-4.0-c001795b80.ova">photon-ova-4.0-c001795b80.ova</a></td><td>bootstrap èŠ‚ç‚¹</td><td>VMware</td></tr><tr><td><a href="https://customerconnect.vmware.com/downloads/get-download?downloadGroup=TCE-090">photon-3-kube-v1.21.2+vmware.1-tkg.2-12816990095845873721.ova</a></td><td>tanzu é›†ç¾¤èŠ‚ç‚¹</td><td>VMware éœ€è´¦æˆ·</td></tr><tr><td><a href="https://github.com/vmware-tanzu/community-edition/releases/download/v0.9.1/tce-linux-amd64-v0.9.1.tar.gz">tce-linux-amd64-v0.9.1.tar.gz</a></td><td>tanzu ç¤¾åŒºç‰ˆ</td><td>GitHub release</td></tr><tr><td><a href="https://github.com/vmware/govmomi/releases/download/v0.27.3/govc_Linux_x86_64.tar.gz">govc_Linux_x86_64.tar.gz</a></td><td>å®‰è£…&#x2F;é…ç½® vCenter</td><td>GitHub release</td></tr></tbody></table><p>æ³¨æ„ ESXi å’Œ vCenter çš„ç‰ˆæœ¬æœ€å¥½æ˜¯ 7.0 åŠä»¥ä¸Šï¼Œæˆ‘åªåœ¨ ESXi 7.0.2 å’Œ vCenter 7.0.3 ä¸Šæµ‹è¯•è¿‡ï¼Œå…¶ä»–ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰äº›å·®å¼‚ï¼›å¦å¤– ESXi çš„ç‰ˆæœ¬ä¸å»ºè®®ä½¿ç”¨æœ€æ–°çš„ 7.0.3ï¼Œå› ä¸ºæœ‰æ¯”è¾ƒä¸¥é‡çš„ bugï¼Œå®˜æ–¹ä¹Ÿå»ºè®®ç”¨æˆ·ç”Ÿäº§ç¯å¢ƒä¸è¦ä½¿ç”¨è¯¥ç‰ˆæœ¬äº† <a href="https://kb.vmware.com/s/article/86287">vSphere 7.0 Update 3 Critical Known Issues - Workarounds &amp; Fix (86287)</a> ã€‚</p><h3 id="å®‰è£…-govc-åŠä¾èµ–"><a href="#å®‰è£…-govc-åŠä¾èµ–" class="headerlink" title="å®‰è£… govc åŠä¾èµ–"></a>å®‰è£… govc åŠä¾èµ–</h3><p>åœ¨æœ¬åœ°æœºå™¨ä¸Šå®‰è£…å¥½ govc å’Œ jqï¼Œè¿™ä¸¤ä¸ªå·¥å…·åé¢åœ¨é…ç½® vCenter çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</p><ul><li>macOS</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ brew <span class="token function">install</span> govc jq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>Debian&#x2F;Ubuntu</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tar</span> -xf govc_Linux_x86_64.tar.gz -C /usr/local/bin$ <span class="token function">apt</span> <span class="token function">install</span> jq -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>å…¶ä»– Linux å¯ä»¥åœ¨ govc å’Œ jq çš„ GitHub ä¸Šä¸‹è½½å¯¹åº”çš„å®‰è£…æ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚</li></ul><h3 id="å®‰è£…-ESXi-OS"><a href="#å®‰è£…-ESXi-OS" class="headerlink" title="å®‰è£… ESXi OS"></a>å®‰è£… ESXi OS</h3><p>ESXi OS çš„å®‰è£…ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæ²¡æœ‰å¤ªå¤šå€¼å¾—è®²è§£çš„åœ°æ–¹ï¼Œå› æ­¤å°±å‚ç…§ä¸€ä¸‹å…¶ä»–å¤§ä½¬å†™çš„åšå®¢æˆ–è€…å®˜æ–¹çš„å®‰è£…æ–‡æ¡£ <a href="https://docs.vmware.com/cn/VMware-vSphere/7.0/vsphere-esxi-701-installation-setup-guide.pdf">VMware ESXi å®‰è£…å’Œè®¾ç½®</a> æ¥å°±è¡Œï¼›éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼ŒESXi OS å®‰è£…æ—¶ VMFSL åˆ†åŒºå°†ä¼šå ç”¨å¤§é‡çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™å°†ä¼šä½¿å¾— ESXi OS å®‰è£…æ‰€åœ¨çš„ç£ç›˜æœ€ç»ˆåˆ›å»ºå‡ºæ¥çš„ datastore æ¯”é¢„æœŸå°å¾ˆå¤šï¼Œè€Œä¸”è¿™ä¸ª VMFSL åˆ†åŒºåœ¨å®‰è£…å¥½ä¹‹åå°±å¾ˆéš¾å†åšè°ƒæ•´äº†ã€‚å› æ­¤å¦‚æœç£ç›˜å­˜å‚¨ç©ºé—´æ¯”è¾ƒç´§å¼ ï¼Œåœ¨å®‰è£… ESXi OS ä¹‹å‰å¯ä»¥è€ƒè™‘ä¸‹å¦‚ä½•å»æ‰è¿™ä¸ªåˆ†åŒºï¼›æˆ–è€…å’Œæˆ‘ä¸€æ ·å°† ESXI OS å®‰è£…åœ¨äº†ä¸€ä¸ª 16G çš„ USB Dom ç›˜ä¸Šï¼Œä¸è¿‡ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®é‡‡ç”¨è¿™ç§æ–¹æ¡ˆ ğŸ˜‚ï¼ˆå…¶å®ä¸ªäººè§‰ç€å®‰è£…åœ¨ U ç›˜ä¸Šé—®é¢˜ä¸å¤§ï¼ŒESXi OS å¯åŠ¨ä¹‹åæ˜¯åŠ è½½åˆ°å†…å­˜ä¸­è¿è¡Œçš„ï¼Œä¸ä¼šå¯¹ U ç›˜æœ‰å¤§é‡çš„è¯»å†™æ“ä½œï¼Œåªä¸è¿‡åœ¨æœºæˆ¿ä¸­ U ç›˜è¢«äººä¸å°å¿ƒæ‹”èµ°å°±å‡‰äº†ã€‚</p><ul><li>è®¾ç½® govc ç¯å¢ƒå˜é‡</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ESXi èŠ‚ç‚¹çš„ IP</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">ESXI_IP</span><span class="token operator">=</span><span class="token string">"192.168.18.47"</span><span class="token comment"># ESXi ç™»å½•çš„ç”¨æˆ·åï¼Œåˆæ¬¡å®‰è£…åé»˜è®¤ä¸º root</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_USERNAME</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token comment"># åœ¨ ESXi å®‰è£…æ—¶è®¾ç½®çš„ root å¯†ç </span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_PASSWORD</span><span class="token operator">=</span><span class="token string">"admin@2022"</span><span class="token comment"># å…è®¸ä¸å®‰å…¨çš„ SSL è¿æ¥</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_INSECURE</span><span class="token operator">=</span>true<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_URL</span><span class="token operator">=</span><span class="token string">"https://<span class="token variable">$&#123;ESXI_IP&#125;</span>"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_DATASTORE</span><span class="token operator">=</span>datastore1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æµ‹è¯• govc æ˜¯å¦èƒ½æ­£å¸¸è¿æ¥ ESXi ä¸»æœº</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Name:              localhost.local  Path:            /ha-datacenter/host/localhost/localhost  Manufacturer:    Dell  Logical CPUs:    <span class="token number">20</span> CPUs @ 2394MHz  Processor type:  Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Xeon<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Silver 4210R CPU @ <span class="token number">2</span>.40GHz  CPU usage:       <span class="token number">579</span> MHz <span class="token punctuation">(</span><span class="token number">1.2</span>%<span class="token punctuation">)</span>  Memory:          261765MB  Memory usage:    <span class="token number">16457</span> MB <span class="token punctuation">(</span><span class="token number">6.3</span>%<span class="token punctuation">)</span>  Boot time:       <span class="token number">2022</span>-02-02 <span class="token number">11</span>:53:59.630124 +0000 UTC  State:           connected<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®‰è£…-vCenter"><a href="#å®‰è£…-vCenter" class="headerlink" title="å®‰è£… vCenter"></a>å®‰è£… vCenter</h3><p>æŒ‰ç…§ VMware å®˜æ–¹çš„ vCenter å®‰è£…æ–‡æ¡£ <a href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vcenter.install.doc/GUID-8DC3866D-5087-40A2-8067-1361A2AF95BD.html">å…³äº vCenter Server å®‰è£…å’Œè®¾ç½®</a> æ¥å®‰è£…å®åœ¨æ˜¯è¿‡äºç¹çï¼Œå…¶å®å®˜æ–¹çš„ ISO å®‰è£…æ–¹å¼æ— éæ˜¯è¿è¡Œä¸€ä¸ª installer web æœåŠ¡ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸Šé…ç½®å¥½ vCenter è™šæ‹Ÿæœºçš„å‚æ•°ï¼Œå†å°†å¡«å†™çš„é…ç½®ä¿¡æ¯åœ¨éƒ¨ç½² vcsa è™šæ‹Ÿæœºçš„æ—¶å€™æ³¨å…¥åˆ° ova çš„é…ç½®å‚æ•°ä¸­ã€‚</p><p>çŸ¥é“è¿™ä¸ªå®‰è£…è¿‡ç¨‹çš„åŸç†ä¹‹åæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±é…ç½® vCenter çš„å‚æ•°ä¿¡æ¯ï¼Œç„¶åé€šè¿‡ govc æ¥éƒ¨ç½² ovaï¼›è¿™æ¯”ä½¿ç”¨ UI çš„æ–¹å¼ç®€å•æ–¹ä¾¿å¾ˆå¤šï¼Œæœ€ç»ˆåªéœ€è¦å¡«å†™ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸€æ¡å‘½ä»¤å°±å¯ä»¥éƒ¨ç½²å®Œæˆå•¦ã€‚</p><ul><li>é¦–å…ˆæ˜¯æŒ‚è½½ vCenter çš„ ISOï¼Œæ‰¾åˆ° vcsa ova æ–‡ä»¶ï¼Œå®ƒæ˜¯ vCenter è™šæ‹Ÿæœºçš„æ¨¡ç‰ˆ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mount</span> -o loop VMware-VCSA-all-7.0.3-18778458.iso /mnt$ <span class="token function">ls</span> /mnt/vcsa/VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10.ova/mnt/vcsa/VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10.ova<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ ¹æ®è‡ªå·±çš„ç¯å¢ƒä¿¡æ¯ä¿®æ”¹ä¸‹é¢å®‰è£…è„šæœ¬ä¸­çš„ç›¸å…³é…ç½®ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token assign-left variable">VCSA_OVA_FILE</span><span class="token operator">=</span><span class="token variable">$1</span><span class="token builtin class-name">set</span> -o errexit<span class="token builtin class-name">set</span> -o nounset<span class="token builtin class-name">set</span> -o pipefail<span class="token comment"># ESXi çš„ IP åœ°å€</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">ESXI_IP</span><span class="token operator">=</span><span class="token string">"192.168.18.47"</span><span class="token comment"># ESXi çš„ç”¨æˆ·å</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_USERNAME</span><span class="token operator">=</span><span class="token string">"root"</span><span class="token comment"># ESXI çš„å¯†ç </span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_PASSWORD</span><span class="token operator">=</span><span class="token string">"admin@2020"</span><span class="token comment"># å®‰è£… vCenter è™šæ‹Ÿæœºä½¿ç”¨çš„ datastore åç§°</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_DATASTORE</span><span class="token operator">=</span>datastore1<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_INSECURE</span><span class="token operator">=</span>true<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_URL</span><span class="token operator">=</span><span class="token string">"https://<span class="token variable">$&#123;ESXI_IP&#125;</span>"</span><span class="token comment"># vCenter çš„ç™»å½•å¯†ç </span><span class="token assign-left variable">VM_PASSWORD</span><span class="token operator">=</span><span class="token string">"admin@2020"</span><span class="token comment"># vCenter çš„ IP åœ°å€</span><span class="token assign-left variable">VM_IP</span><span class="token operator">=</span><span class="token number">192.168</span>.20.92<span class="token comment"># vCenter è™šæ‹Ÿæœºçš„åç§°</span><span class="token assign-left variable">VM_NAME</span><span class="token operator">=</span>vCenter-Server-Appliance<span class="token comment"># vCenter è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘ç»œ</span><span class="token assign-left variable">VM_NETWORK</span><span class="token operator">=</span><span class="token string">"VM Network"</span><span class="token comment"># DNS æœåŠ¡å™¨</span><span class="token assign-left variable">VM_DNS</span><span class="token operator">=</span><span class="token string">"223.6.6.6"</span><span class="token comment"># NTP æœåŠ¡å™¨</span><span class="token assign-left variable">VM_NTP</span><span class="token operator">=</span><span class="token string">"0.pool.ntp.org"</span><span class="token function-name function">deploy_vcsa_vm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token assign-left variable">config</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>govc host.info -k -json <span class="token operator">|</span> jq -r <span class="token string">'.HostSystems[].Config'</span><span class="token variable">)</span></span>    <span class="token assign-left variable">gateway</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -r <span class="token string">'.Network.IpRouteConfig.DefaultGateway'</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$config</span>"</span><span class="token variable">)</span></span>    <span class="token assign-left variable">route</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -r <span class="token string">'.Network.RouteTableInfo.IpRoute[] | select(.DeviceName == "vmk0") | select(.Gateway == "0.0.0.0")'</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$config</span>"</span><span class="token variable">)</span></span>    <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>jq -r <span class="token string">'.PrefixLength'</span> <span class="token operator">&lt;&lt;&lt;</span><span class="token string">"<span class="token variable">$route</span>"</span><span class="token variable">)</span></span>    <span class="token assign-left variable">opts</span><span class="token operator">=</span><span class="token punctuation">(</span>        cis.vmdir.password<span class="token operator">=</span><span class="token variable">$&#123;VM_PASSWORD&#125;</span>        cis.appliance.root.passwd<span class="token operator">=</span><span class="token variable">$&#123;VM_PASSWORD&#125;</span>        cis.appliance.root.shell<span class="token operator">=</span>/bin/bash        cis.deployment.node.type<span class="token operator">=</span>embedded        cis.vmdir.domain-name<span class="token operator">=</span>vsphere.local        cis.vmdir.site-name<span class="token operator">=</span>VCSA        cis.appliance.net.addr.family<span class="token operator">=</span>ipv4        cis.appliance.ssh.enabled<span class="token operator">=</span>True        cis.ceip_enabled<span class="token operator">=</span>False        cis.deployment.autoconfig<span class="token operator">=</span>True        cis.appliance.net.addr<span class="token operator">=</span><span class="token variable">$&#123;VM_IP&#125;</span>        cis.appliance.net.prefix<span class="token operator">=</span><span class="token variable">$&#123;prefix&#125;</span>        cis.appliance.net.dns.servers<span class="token operator">=</span><span class="token variable">$&#123;VM_DNS&#125;</span>        cis.appliance.net.gateway<span class="token operator">=</span><span class="token variable">$gateway</span>        cis.appliance.ntp.servers<span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;VM_NTP&#125;</span>"</span>        cis.appliance.net.mode<span class="token operator">=</span>static    <span class="token punctuation">)</span>    <span class="token assign-left variable">props</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> -- <span class="token string">"guestinfo.%s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">$&#123;opts<span class="token punctuation">[</span>@<span class="token punctuation">]</span>&#125;</span>"</span> <span class="token operator">|</span> jq --slurp -R 'split<span class="token punctuation">(</span><span class="token string">"<span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span> <span class="token operator">|</span> map<span class="token punctuation">(</span>select<span class="token punctuation">(</span>. <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token variable">)</span></span> <span class="token operator">|</span> map<span class="token punctuation">(</span>split<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">))</span> <span class="token operator">|</span> map<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"Key"</span><span class="token builtin class-name">:</span> .<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>, <span class="token string">"Value"</span><span class="token builtin class-name">:</span> .<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>'<span class="token punctuation">)</span>    <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> govc import.<span class="token variable">$&#123;VCSA_OVA_FILE<span class="token operator">##</span>*.&#125;</span> -options - <span class="token string">"<span class="token variable">$&#123;VCSA_OVA_FILE&#125;</span>"</span></span>    &#123;    "Name": "<span class="token variable">$&#123;VM_NAME&#125;</span>",    "Deployment": "tiny",    "DiskProvisioning": "thin",    "IPProtocol": "IPv4",    "Annotation": "VMware vCenter Server Appliance",    "PowerOn": false,    "WaitForIP": false,    "InjectOvfEnv": true,    "NetworkMapping": [        &#123;        "Name": "Network 1",        "Network": "<span class="token variable">$&#123;VM_NETWORK&#125;</span>"        &#125;    ],    "PropertyMapping": <span class="token variable">$&#123;props&#125;</span>    &#125;EOF</span><span class="token punctuation">&#125;</span>deploy_vcsa_vmgovc vm.change -vm <span class="token string">"<span class="token variable">$&#123;VM_NAME&#125;</span>"</span> -g vmwarePhoton64Guestgovc vm.power -on <span class="token string">"<span class="token variable">$&#123;VM_NAME&#125;</span>"</span>govc vm.ip -a <span class="token string">"<span class="token variable">$&#123;VM_NAME&#125;</span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€šè¿‡è„šæœ¬å®‰è£… vCenterï¼ŒæŒ‡å®šç¬¬ä¸€å‚æ•°ä¸º OVA çš„ç»å¯¹è·¯å¾„ã€‚è¿è¡Œå®Œåå°†ä¼šè‡ªåŠ¨å°† ova å¯¼å…¥åˆ° vCenterï¼Œå¹¶å¯åŠ¨è™šæ‹Ÿæœºï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ‰§è¡Œè¯¥è„šæœ¬ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥ vCenter ISO ä¸­ vcsa ova æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span>$ <span class="token function">bash</span> install-vcsa.sh /mnt/vcsa/VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10.ova<span class="token punctuation">[</span>03-02-22 <span class="token number">18</span>:40:19<span class="token punctuation">]</span> Uploading VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10-disk1.vmdk<span class="token punctuation">..</span>. OK<span class="token punctuation">[</span>03-02-22 <span class="token number">18</span>:41:09<span class="token punctuation">]</span> Uploading VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10-disk2.vmdk<span class="token punctuation">..</span>. <span class="token punctuation">(</span><span class="token number">29</span>%, <span class="token number">52</span>.5MiB/s<span class="token punctuation">)</span><span class="token punctuation">[</span>03-02-22 <span class="token number">18</span>:43:08<span class="token punctuation">]</span> Uploading VMware-vCenter-Server-Appliance-7.0.3.00100-18778458_OVF10-disk2.vmdk<span class="token punctuation">..</span>. OK<span class="token punctuation">[</span>03-02-22 <span class="token number">18</span>:43:08<span class="token punctuation">]</span> Injecting OVF environment<span class="token punctuation">..</span>.Powering on VirtualMachine:3<span class="token punctuation">..</span>. OKfe80::20c:29ff:fe03:2f80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è®¾ç½® vCenter ç™»å½•çš„ç¯å¢ƒå˜é‡ï¼Œæˆ‘ä»¬ä½¿ç”¨ govc æ¥é…ç½® vCenterï¼Œé€šè¿‡æµè§ˆå™¨ Web UI çš„æ–¹å¼é…ç½®èµ·æ¥æ•ˆç‡æœ‰ç‚¹ä½ï¼Œä¸å¦‚ govc å‘½ä»¤ä¸€æŠŠæ¢­æ–¹ä¾¿ ğŸ˜‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_URL</span><span class="token operator">=</span><span class="token string">"https://192.168.20.92"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_USERNAME</span><span class="token operator">=</span><span class="token string">"administrator@vsphere.local"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_PASSWORD</span><span class="token operator">=</span><span class="token string">"admin@2022"</span><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_INSECURE</span><span class="token operator">=</span>true<span class="token builtin class-name">export</span> <span class="token assign-left variable">GOVC_DATASTORE</span><span class="token operator">=</span>datastore1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è™šæ‹Ÿæœºå¯åŠ¨åå°†è‡ªåŠ¨è¿›è¡Œ vCenter çš„å®‰è£…é…ç½®ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ vCenter å®‰è£…å¥½ä¹‹åï¼Œä½¿ç”¨ govc about æŸ¥çœ‹ vCenter çš„ä¿¡æ¯ï¼Œå¦‚æœèƒ½æ­£ç¡®æˆ–æ¸ é“è¯´æ˜ vCenter å°±å®‰è£…å¥½äº†ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ govc aboutFullName:     VMware vCenter Server <span class="token number">7.0</span>.3 build-18778458Name:         VMware vCenter ServerVendor:       VMware, Inc.Version:      <span class="token number">7.0</span>.3Build:        <span class="token number">18778458</span>OS type:      linux-x64API type:     VirtualCenterAPI version:  <span class="token number">7.0</span>.3.0Product ID:   vpxUUID:         0b49e119-e38f-4fbc-84a8-d7a0e548027d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é…ç½®-vCenter"><a href="#é…ç½®-vCenter" class="headerlink" title="é…ç½® vCenter"></a>é…ç½® vCenter</h3><p>è¿™ä¸€æ­¥éª¤ä¸»è¦æ˜¯é…ç½® vCenterï¼šåˆ›å»º Datacenterã€clusterã€folder ç­‰èµ„æºï¼Œå¹¶å°† ESXi ä¸»æœºæ·»åŠ åˆ° cluster ä¸­ï¼›</p><ul><li>é…ç½® vCenter</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># åˆ›å»º Datacenter æ•°æ®ä¸­å¿ƒ</span>$ govc datacenter.create SH-IDC<span class="token comment"># åˆ›å»º Cluster é›†ç¾¤</span>$ govc cluster.create -dc<span class="token operator">=</span>SH-IDC Tanzu-Cluster<span class="token comment"># å°† ESXi ä¸»æœºæ·»åŠ åˆ° Cluster å½“ä¸­</span>$ govc cluster.add -dc<span class="token operator">=</span>SH-IDC -cluster<span class="token operator">=</span>Tanzu-Cluster -hostname<span class="token operator">=</span><span class="token number">192.168</span>.18.47 --username<span class="token operator">=</span>root -password<span class="token operator">=</span><span class="token string">'admin@2020'</span> -noverify<span class="token comment"># åˆ›å»º folderï¼Œç”¨äºå°† Tanzu çš„èŠ‚ç‚¹è™šæ‹Ÿæœºå­˜æ”¾åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹</span>$ govc folder.create /SH-IDC/vm/Tanzu-node<span class="token comment"># å¯¼å…¥ tanzu æ±²å–èŠ‚ç‚¹çš„è™šæ‹Ÿæœº ova æ¨¡ç‰ˆ</span>$ govc import.ova -dc<span class="token operator">=</span><span class="token string">'SH-IDC'</span> -ds<span class="token operator">=</span><span class="token string">'datastore1'</span> photon-3-kube-v1.21.2+vmware.1-tkg.2-12816990095845873721.ova<span class="token comment"># å°†è™šæ‹Ÿæœºè½¬æ¢ä¸ºæ¨¡ç‰ˆï¼Œåç»­ tanzu é›†ç¾¤å°†ä»¥è¯¥æ¨¡ç‰ˆåˆ›å»ºè™šæ‹Ÿæœº</span>$ govc vm.markastemplate photon-3-kube-v1.21.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆå§‹åŒ–-bootstrap-èŠ‚ç‚¹"><a href="#åˆå§‹åŒ–-bootstrap-èŠ‚ç‚¹" class="headerlink" title="åˆå§‹åŒ– bootstrap èŠ‚ç‚¹"></a>åˆå§‹åŒ– bootstrap èŠ‚ç‚¹</h3><p>bootstrap èŠ‚ç‚¹èŠ‚ç‚¹æ˜¯ç”¨äºè¿è¡Œ tanzu éƒ¨ç½²å·¥å…·çš„èŠ‚ç‚¹ï¼Œå®˜æ–¹æ˜¯æ”¯æŒ Linux&#x2F;macOS&#x2F;Windows ä¸‰ç§æ“ä½œç³»ç»Ÿçš„ï¼Œä½†æœ‰ä¸€äº›æ¯”è¾ƒä¸¥æ ¼çš„è¦æ±‚ï¼š</p><table><thead><tr><th>Arch: x86; ARM is currently unsupported</th></tr></thead><tbody><tr><td>RAM: 6 GB</td></tr><tr><td>CPU: 2</td></tr><tr><td><a href="https://docs.docker.com/engine/install/">Docker</a> Add your non-root user account to the docker user group. Create the group if it does not already exist. This lets the Tanzu CLI access the Docker socket, which is owned by the root user. For more information, see steps 1 to 4 in the <a href="https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user">Manage Docker as a non-root user</a> procedure in the Docker documentation.</td></tr><tr><td><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">Kubectl</a></td></tr><tr><td>Latest version of Chrome, Firefox, Safari, Internet Explorer, or Edge</td></tr><tr><td>System time is synchronized with a Network Time Protocol (NTP) server.</td></tr><tr><td>Ensure your bootstrap machine is using <a href="https://man7.org/linux/man-pages/man7/cgroups.7.html">cgroup v1</a>. For more information, see <a href="https://tanzucommunityedition.io/docs/latest/support-matrix/#check-and-set-the-cgroup">Check and set the cgroup</a>.</td></tr></tbody></table><p>åœ¨è¿™é‡Œä¸ºäº†é¿å…è¿™äº›éº»çƒ¦çš„é…ç½®ï¼Œæˆ‘å°±ç›´æ¥ä½¿ç”¨çš„ VMware å®˜æ–¹çš„ <a href="https://github.com/vmware/photon/wiki/Downloading-Photon-OS#photon-os-40-rev2-binaries">Photon OS 4.0 Rev2</a> ï¼Œä¸‹è½½ OVA æ ¼å¼çš„é•œåƒç›´æ¥å¯¼å…¥åˆ° ESXi ä¸»æœºå¯åŠ¨ä¸€å°è™šæ‹Ÿæœºå³å¯ï¼Œèƒ½èŠ‚çœä¸å°‘éº»çƒ¦çš„é…ç½®ï¼›è¿˜æœ‰ä¸€ä¸ªå¥½å¤„å°±æ˜¯åœ¨ä¸€å°å•ç‹¬çš„è™šæ‹Ÿæœºä¸Šè¿è¡Œ tanzu éƒ¨ç½²å·¥å…·ä¸ä¼šæ±¡æŸ“æœ¬åœ°çš„å¼€å‘ç¯å¢ƒã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">wget</span> https://packages.vmware.com/photon/4.0/Rev2/ova/photon-ova-4.0-c001795b80.ova<span class="token comment"># å¯¼å…¥ OVA è™šæ‹Ÿæœºæ¨¡ç‰ˆ</span>$ govc import.ova -ds<span class="token operator">=</span><span class="token string">'datastore1'</span> -name bootstrap-node photon-ova-4.0-c001795b80.ova<span class="token comment"># ä¿®æ”¹ä¸€ä¸‹è™šæ‹Ÿæœºçš„é…ç½®ï¼Œè°ƒæ•´ä¸º 4C8G</span>$ govc vm.change -c <span class="token number">4</span> -m <span class="token number">8192</span> -vm bootstrap-node<span class="token comment"># å¼€å¯è™šæ‹Ÿæœº</span>$ govc vm.power -on bootstrap-node<span class="token comment"># æŸ¥çœ‹è™šæ‹Ÿæœºè·å–åˆ°çš„ IPv4 åœ°å€</span>$ govc vm.ip -a -wait 1m bootstrap-node$ <span class="token function">ssh</span> root@192.168.74.10<span class="token comment"># å¯†ç é»˜è®¤ä¸º changemeï¼Œè¾“å…¥å®Œå¯†ç ä¹‹åæç¤ºåœ¨è¾“å…¥ä¸€é changemeï¼Œç„¶åå†ä¿®æ”¹æ–°çš„å¯†ç </span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># cat /etc/os-release</span><span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"VMware Photon OS"</span><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"4.0"</span><span class="token assign-left variable">ID</span><span class="token operator">=</span>photon<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token number">4.0</span><span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"VMware Photon OS/Linux"</span><span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"1;34"</span><span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://vmware.github.io/photon/"</span><span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://github.com/vmware/photon/issues"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å®‰è£…éƒ¨ç½²æ—¶éœ€è¦çš„ä¸€äº›å·¥å…·ï¼ˆåˆ‡ï¼ŒPhoton OS é‡Œç«Ÿç„¶è¿ä¸ª tar å‘½ä»¤éƒ½æ²¡æœ‰ ğŸ˜ </li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># tdnf install sudo tar -y</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># curl -LO https://dl.k8s.io/release/v1.21.2/bin/linux/amd64/kubectl</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å¯åŠ¨ dockerï¼Œbootstrap èŠ‚ç‚¹ä¼šä»¥ kind çš„æ–¹å¼è¿è¡Œä¸€ä¸ª K8s é›†ç¾¤ï¼Œéœ€è¦ç”¨åˆ° dockerã€‚è™½ç„¶å¯ä»¥ä½¿ç”¨å¤–éƒ¨çš„ k8s é›†ç¾¤ï¼Œä½†ä¸æ˜¯å¾ˆæ¨èï¼Œå› ä¸º cluster-api ä¾èµ– k8s çš„ç‰ˆæœ¬ï¼Œä¸èƒ½å¤ªé«˜ä¹Ÿä¸èƒ½å¤ªä½ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># systemctl enable docker --now</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ä» <a href="https://github.com/vmware-tanzu/community-edition/releases/tag/v0.9.1">vmware-tanzu&#x2F;community-edition</a> ä¸‹è½½ tanzu ç¤¾åŒºç‰ˆçš„å®‰è£…åŒ…ï¼Œç„¶åè§£å‹åå®‰è£…ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># curl -LO  https://github.com/vmware-tanzu/community-edition/releases/download/v0.9.1/tce-linux-amd64-v0.9.1.tar.gz</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># tar -xf tce-linux-amd64-v0.9.1.tar.gz</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># cd tce-linux-amd64-v0.9.1/</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># bash install.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶è€Œä¸å¹¸åœ°ç¿»è½¦äº†ï¼Œ install.sh è„šæœ¬ä¸­ç¦æ­¢ root ç”¨æˆ·è¿è¡Œ</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">+ <span class="token assign-left variable">ALLOW_INSTALL_AS_ROOT</span><span class="token operator">=</span>+ <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">0</span> -eq <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>+ <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">''</span> <span class="token operator">!=</span> <span class="token punctuation">\</span>t<span class="token punctuation">\</span>r<span class="token punctuation">\</span>u<span class="token punctuation">\</span>e <span class="token punctuation">]</span><span class="token punctuation">]</span>+ <span class="token builtin class-name">echo</span> <span class="token string">'Do not run this script as root'</span>Do not run this script as root+ <span class="token builtin class-name">exit</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘å°±ååè¦ä»¥ root ç”¨æˆ·æ¥è¿è¡Œæ€ä¹ˆæƒ¹ ğŸ˜¡</p><p><img src="https://p.k8s.li/2022-01-22-deploy-tanzu-k8s-cluster-01.jpg"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># sed å»æ‰ç¬¬ä¸€ä¸ª exit 1 å°±å¯ä»¥äº†</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># sed -i.bak "s/exit 1//" install.sh</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># bash install.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å®‰è£…å¥½ä¹‹åä¼šè¾“å‡º <code>Installation complete!</code>ï¼ˆè®²çœŸå®˜æ–¹çš„ install.sh è„šæœ¬è¾“å‡ºå¾ˆä¸å‹å¥½ï¼Œæ±¡æŸ“æˆ‘çš„ terminal</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">+ tanzu init<span class="token operator">|</span> initializing âœ”  successfully initialized CLI++ tanzu plugin repo list++ <span class="token function">grep</span> tce+ <span class="token assign-left variable">TCE_REPO</span><span class="token operator">=</span>+ <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>+ tanzu plugin repo <span class="token function">add</span> --name tce --gcp-bucket-name tce-tanzu-cli-plugins --gcp-root-path artifacts++ tanzu plugin repo list++ <span class="token function">grep</span> core-admin+ <span class="token assign-left variable">TCE_REPO</span><span class="token operator">=</span>+ <span class="token punctuation">[</span><span class="token punctuation">[</span> -z <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span>+ tanzu plugin repo <span class="token function">add</span> --name core-admin --gcp-bucket-name tce-tanzu-cli-framework-admin --gcp-root-path artifacts-admin+ <span class="token builtin class-name">echo</span> <span class="token string">'Installation complete!'</span>Installation complete<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éƒ¨ç½²ç®¡ç†é›†ç¾¤"><a href="#éƒ¨ç½²ç®¡ç†é›†ç¾¤" class="headerlink" title="éƒ¨ç½²ç®¡ç†é›†ç¾¤"></a>éƒ¨ç½²ç®¡ç†é›†ç¾¤</h3><p>å…ˆæ˜¯éƒ¨ç½²ä¸€ä¸ª tanzu çš„ç®¡ç†é›†ç¾¤ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€šè¿‡ <a href="https://tanzucommunityedition.io/docs/latest/getting-started/">å®˜æ–¹æ–‡æ¡£</a> æåˆ°çš„é€šè¿‡ Web UI çš„æ–¹å¼ã€‚ç›®å‰è¿™ä¸ª UI ç•Œé¢æ¯”è¾ƒæ‹‰å®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è®©ç”¨æˆ·å¡«å†™ä¸€äº›é…ç½®å‚æ•°ï¼Œç„¶åè°ƒç”¨åå°çš„ tanzu å‘½ä»¤æ¥éƒ¨ç½²é›†ç¾¤ã€‚å¹¶æŠŠé›†ç¾¤éƒ¨ç½²çš„æ—¥å¿—å’Œè¿›åº¦å±•ç¤ºå‡ºæ¥ï¼›éƒ¨ç½²å®Œæˆä¹‹åï¼Œè¿™ä¸ª UI åˆä¸èƒ½ç®¡ç†è¿™äº›é›†ç¾¤ï¼Œåˆä¸æ”¯æŒéƒ¨ç½² workload é›†ç¾¤ï¼ˆ</p><p>å¦ä¸€ç§å°±æ˜¯é€šè¿‡ tanzu å‘½ä»¤æŒ‡å®šé…ç½®æ–‡ä»¶æ¥éƒ¨ç½²ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦é€šè¿‡æµè§ˆå™¨åœ¨ web é¡µé¢ä¸Šå‚»ä¹ä¹åœ°ç‚¹æ¥ç‚¹å»å¡«ä¸€äº›å‚æ•°ï¼Œåªéœ€è¦æå‰å¡«å†™å¥½ä¸€ä¸ª yaml æ ¼å¼çš„é…ç½®æ–‡ä»¶å³å¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±é‡‡ç”¨ tanzu å‘½ä»¤æ¥éƒ¨ç½²é›†ç¾¤ï¼Œç®¡ç†é›†ç¾¤çš„é…ç½®æ–‡ä»¶æ¨¡ç‰ˆå¦‚ä¸‹ï¼š</p><ul><li>tanzu-mgt-cluster.yaml</li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Cluster Pod IP çš„ CIDR</span><span class="token key atrule">CLUSTER_CIDR</span><span class="token punctuation">:</span> 100.96.0.0/11<span class="token comment"># Service çš„ CIDR</span><span class="token key atrule">SERVICE_CIDR</span><span class="token punctuation">:</span> 100.64.0.0/13<span class="token comment"># é›†ç¾¤çš„åç§°</span><span class="token key atrule">CLUSTER_NAME</span><span class="token punctuation">:</span> tanzu<span class="token punctuation">-</span>control<span class="token punctuation">-</span>plan<span class="token comment"># é›†ç¾¤çš„ç±»å‹</span><span class="token key atrule">CLUSTER_PLAN</span><span class="token punctuation">:</span> dev<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹çš„ arch</span><span class="token key atrule">OS_ARCH</span><span class="token punctuation">:</span> amd64<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹çš„ OS åç§°</span><span class="token key atrule">OS_NAME</span><span class="token punctuation">:</span> photon<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹ OS ç‰ˆæœ¬</span><span class="token key atrule">OS_VERSION</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token comment"># åŸºç¡€è®¾æ–½èµ„æºçš„æä¾›æ–¹</span><span class="token key atrule">INFRASTRUCTURE_PROVIDER</span><span class="token punctuation">:</span> vsphere<span class="token comment"># é›†ç¾¤çš„ VIP</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_ENDPOINT</span><span class="token punctuation">:</span> 192.168.75.194<span class="token comment"># control-plan èŠ‚ç‚¹çš„ç£ç›˜å¤§å°</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_DISK_GIB</span><span class="token punctuation">:</span> <span class="token string">"20"</span><span class="token comment"># control-plan èŠ‚ç‚¹çš„å†…å­˜å¤§å°</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_MEM_MIB</span><span class="token punctuation">:</span> <span class="token string">"8192"</span><span class="token comment"># control-plan èŠ‚ç‚¹çš„ CPU æ ¸å¿ƒæ•°é‡</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_NUM_CPUS</span><span class="token punctuation">:</span> <span class="token string">"4"</span><span class="token comment"># work èŠ‚ç‚¹çš„ç£ç›˜å¤§å°</span><span class="token key atrule">VSPHERE_WORKER_DISK_GIB</span><span class="token punctuation">:</span> <span class="token string">"20"</span><span class="token comment"># work èŠ‚ç‚¹çš„å†…å­˜å¤§å°</span><span class="token key atrule">VSPHERE_WORKER_MEM_MIB</span><span class="token punctuation">:</span> <span class="token string">"4096"</span><span class="token comment"># work èŠ‚ç‚¹çš„ CPU æ ¸å¿ƒæ•°é‡</span><span class="token key atrule">VSPHERE_WORKER_NUM_CPUS</span><span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token comment"># vCenter çš„ Datacenter è·¯å¾„</span><span class="token key atrule">VSPHERE_DATACENTER</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC<span class="token comment"># è™šæ‹Ÿæœºåˆ›å»ºçš„ Datastore è·¯å¾„</span><span class="token key atrule">VSPHERE_DATASTORE</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/datastore/datastore1<span class="token comment"># è™šæ‹Ÿæœºåˆ›å»ºçš„æ–‡ä»¶å¤¹</span><span class="token key atrule">VSPHERE_FOLDER</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/vm/Tanzu<span class="token punctuation">-</span>node<span class="token comment"># è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘ç»œ</span><span class="token key atrule">VSPHERE_NETWORK</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/network/VM Network<span class="token comment"># è™šæ‹Ÿæœºå…³è”çš„èµ„æºæ± </span><span class="token key atrule">VSPHERE_RESOURCE_POOL</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/host/Tanzu<span class="token punctuation">-</span>Cluster/Resources<span class="token comment"># vCenter çš„ IP</span><span class="token key atrule">VSPHERE_SERVER</span><span class="token punctuation">:</span> 192.168.75.110<span class="token comment"># vCenter çš„ç”¨æˆ·å</span><span class="token key atrule">VSPHERE_USERNAME</span><span class="token punctuation">:</span> administrator@vsphere.local<span class="token comment"># vCenter çš„å¯†ç ï¼Œä»¥ base64 ç¼–ç </span><span class="token key atrule">VSPHERE_PASSWORD</span><span class="token punctuation">:</span> &lt;encoded<span class="token punctuation">:</span>base64password<span class="token punctuation">></span><span class="token comment"># vCenter çš„è¯ä¹¦æŒ‡çº¹ï¼Œå¯ä»¥é€šè¿‡ govc about.cert -json | jq -r '.ThumbprintSHA1' è·å–</span><span class="token key atrule">VSPHERE_TLS_THUMBPRINT</span><span class="token punctuation">:</span> EB<span class="token punctuation">:</span>F3<span class="token punctuation">:</span>D8<span class="token punctuation">:</span>7A<span class="token punctuation">:</span>E8<span class="token punctuation">:</span>3D<span class="token punctuation">:</span>1A<span class="token punctuation">:</span>59<span class="token punctuation">:</span>B0<span class="token punctuation">:</span>DE<span class="token punctuation">:</span>73<span class="token punctuation">:</span>96<span class="token punctuation">:</span>DC<span class="token punctuation">:</span>B9<span class="token punctuation">:</span>5F<span class="token punctuation">:</span>13<span class="token punctuation">:</span>86<span class="token punctuation">:</span>EF<span class="token punctuation">:</span>B6<span class="token punctuation">:</span><span class="token number">27</span><span class="token comment"># è™šæ‹Ÿæœºæ³¨å…¥çš„ ssh å…¬é’¥ï¼Œéœ€è¦ç”¨å®ƒæ¥ ssh ç™»å½•é›†ç¾¤èŠ‚ç‚¹</span><span class="token key atrule">VSPHERE_SSH_AUTHORIZED_KEY</span><span class="token punctuation">:</span> ssh<span class="token punctuation">-</span>rsa<span class="token comment"># ä¸€äº›é»˜è®¤å‚æ•°</span><span class="token key atrule">AVI_ENABLE</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">IDENTITY_MANAGEMENT_TYPE</span><span class="token punctuation">:</span> none<span class="token key atrule">ENABLE_AUDIT_LOGGING</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">ENABLE_CEIP_PARTICIPATION</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">TKG_HTTP_PROXY_ENABLED</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">DEPLOY_TKG_ON_VSPHERE7</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€šè¿‡ tanzu CLI éƒ¨ç½²ç®¡ç†é›†ç¾¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ tanzu management-cluster create --file tanzu-mgt-cluster.yaml -v6<span class="token comment"># å¦‚æœæ²¡æœ‰é…ç½® VSPHERE_TLS_THUMBPRINT ä¼šæœ‰ä¸€ä¸ªç¡®è®¤ vSphere thumbprint çš„äº¤äº’ï¼Œè¾“å…¥ Y å°±å¯ä»¥</span>Validating the pre-requisites<span class="token punctuation">..</span>.Do you want to <span class="token builtin class-name">continue</span> with the vSphere thumbprint EB:F3:D8:7A:E8:3D:1A:59:B0:DE:73:96:DC:B9:5F:13:86:EF:B6:27 <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>: y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éƒ¨ç½²æ—¥å¿—"><a href="#éƒ¨ç½²æ—¥å¿—" class="headerlink" title="éƒ¨ç½²æ—¥å¿—"></a>éƒ¨ç½²æ—¥å¿—</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># tanzu management-cluster create --file tanzu-mgt-cluster.yaml -v 6</span>compatibility <span class="token function">file</span> <span class="token punctuation">(</span>/root/.config/tanzu/tkg/compatibility/tkg-compatibility.yaml<span class="token punctuation">)</span> already exists, skipping downloadBOM files inside /root/.config/tanzu/tkg/bom already exists, skipping downloadCEIP Opt-in status: <span class="token boolean">false</span>Validating the pre-requisites<span class="token punctuation">..</span>.vSphere <span class="token number">7.0</span> Environment Detected.You have connected to a vSphere <span class="token number">7.0</span> environment <span class="token function">which</span> does not have vSphere with Tanzu enabled. vSphere with Tanzu includesan integrated Tanzu Kubernetes Grid Service <span class="token function">which</span> turns a vSphere cluster into a platform <span class="token keyword">for</span> running Kubernetes workloads <span class="token keyword">in</span> dedicatedresource pools. Configuring Tanzu Kubernetes Grid Service is <span class="token keyword">done</span> through vSphere HTML5 client.Tanzu Kubernetes Grid Service is the preferred way to consume Tanzu Kubernetes Grid <span class="token keyword">in</span> vSphere <span class="token number">7.0</span> environments. Alternatively you maydeploy a non-integrated Tanzu Kubernetes Grid instance on vSphere <span class="token number">7.0</span>.Deploying TKG management cluster on vSphere <span class="token number">7.0</span> <span class="token punctuation">..</span>.Identity Provider not configured. Some authentication features won<span class="token string">'t work.Checking if VSPHERE_CONTROL_PLANE_ENDPOINT 192.168.20.94 is already in useSetting up management cluster...Validating configuration...Using infrastructure provider vsphere:v0.7.10Generating cluster configuration...Setting up bootstrapper...Fetching configuration for kind node image...kindConfig: &amp;&#123;&#123;Cluster kind.x-k8s.io/v1alpha4&#125;  [&#123;  map[] [&#123;/var/run/docker.sock /var/run/docker.sock false false &#125;] [] [] []&#125;] &#123; 0  100.96.0.0/11 100.64.0.0/13 false &#125; map[] map[] [apiVersion: kubeadm.k8s.io/v1beta2kind: ClusterConfigurationimageRepository: projects.registry.vmware.com/tkgetcd:  local:    imageRepository: projects.registry.vmware.com/tkg    imageTag: v3.4.13_vmware.15dns:  type: CoreDNS  imageRepository: projects.registry.vmware.com/tkg  imageTag: v1.8.0_vmware.5] [] [] []&#125;Creating kind cluster: tkg-kind-c7vj6kds0a6sf43e6210Creating cluster "tkg-kind-c7vj6kds0a6sf43e6210" ...Ensuring node image (projects.registry.vmware.com/tkg/kind/node:v1.21.2_vmware.1) ...Pulling image: projects.registry.vmware.com/tkg/kind/node:v1.21.2_vmware.1 ...Preparing nodes ...Writing configuration ...Starting control-plane ...Installing CNI ...Installing StorageClass ...Waiting 2m0s for control-plane = Ready ...Ready after 19sBootstrapper created. Kubeconfig: /root/.kube-tkg/tmp/config_3fkzTCOLInstalling providers on bootstrapper...Fetching providersInstalling cert-manager Version="v1.1.0"Waiting for cert-manager to be available...Installing Provider="cluster-api" Version="v0.3.23" TargetNamespace="capi-system"Installing Provider="bootstrap-kubeadm" Version="v0.3.23" TargetNamespace="capi-kubeadm-bootstrap-system"Installing Provider="control-plane-kubeadm" Version="v0.3.23" TargetNamespace="capi-kubeadm-control-plane-system"Installing Provider="infrastructure-vsphere" Version="v0.7.10" TargetNamespace="capv-system"installed  Component=="cluster-api"  Type=="CoreProvider"  Version=="v0.3.23"installed  Component=="kubeadm"  Type=="BootstrapProvider"  Version=="v0.3.23"installed  Component=="kubeadm"  Type=="ControlPlaneProvider"  Version=="v0.3.23"installed  Component=="vsphere"  Type=="InfrastructureProvider"  Version=="v0.7.10"Waiting for provider infrastructure-vsphereWaiting for provider control-plane-kubeadmWaiting for provider cluster-apiWaiting for provider bootstrap-kubeadmWaiting for resource capi-kubeadm-control-plane-controller-manager of type *v1.Deployment to be up and runningpods are not yet running for deployment '</span>capi-kubeadm-control-plane-controller-manager<span class="token string">' in namespace '</span>capi-kubeadm-control-plane-system<span class="token string">', retryingPassed waiting on provider bootstrap-kubeadm after 25.205820854spods are not yet running for deployment '</span>capi-controller-manager<span class="token string">' in namespace '</span>capi-webhook-system<span class="token string">', retryingPassed waiting on provider infrastructure-vsphere after 30.185406332sPassed waiting on provider cluster-api after 30.213216243sSuccess waiting on all providers.Start creating management cluster...patch cluster object with operation status:&#123;"metadata": &#123;"annotations": &#123;"TKGOperationInfo" : "&#123;\"Operation\":\"Create\",\"OperationStartTimestamp\":\"2022-02-06 02:35:34.30219421 +0000 UTC\",\"OperationTimeout\":1800&#125;","TKGOperationLastObservedTimestamp" : "2022-02-06 02:35:34.30219421 +0000 UTC"&#125;&#125;&#125;cluster control plane is still being initialized, retryingGetting secret for clusterWaiting for resource tanzu-control-plan-kubeconfig of type *v1.Secret to be up and runningSaving management cluster kubeconfig into /root/.kube/configInstalling providers on management cluster...Fetching providersInstalling cert-manager Version="v1.1.0"Waiting for cert-manager to be available...Installing Provider="cluster-api" Version="v0.3.23" TargetNamespace="capi-system"Installing Provider="bootstrap-kubeadm" Version="v0.3.23" TargetNamespace="capi-kubeadm-bootstrap-system"Installing Provider="control-plane-kubeadm" Version="v0.3.23" TargetNamespace="capi-kubeadm-control-plane-system"Installing Provider="infrastructure-vsphere" Version="v0.7.10" TargetNamespace="capv-system"installed  Component=="cluster-api"  Type=="CoreProvider"  Version=="v0.3.23"installed  Component=="kubeadm"  Type=="BootstrapProvider"  Version=="v0.3.23"installed  Component=="kubeadm"  Type=="ControlPlaneProvider"  Version=="v0.3.23"installed  Component=="vsphere"  Type=="InfrastructureProvider"  Version=="v0.7.10"Waiting for provider control-plane-kubeadmWaiting for provider bootstrap-kubeadmWaiting for provider infrastructure-vsphereWaiting for provider cluster-apiWaiting for resource capi-kubeadm-control-plane-controller-manager of type *v1.Deployment to be up and runningPassed waiting on provider control-plane-kubeadm after 10.046865402sWaiting for resource antrea-controller of type *v1.Deployment to be up and runningMoving all Cluster API objects from bootstrap cluster to management cluster...Performing move...Discovering Cluster API objectsMoving Cluster API objects Clusters=1Creating objects in the target clusterDeleting objects from the source clusterWaiting for additional components to be up and running...Waiting for packages to be up and running...Waiting for package: antreaWaiting for package: metrics-serverWaiting for package: tanzu-addons-managerWaiting for package: vsphere-cpiWaiting for package: vsphere-csiWaiting for resource antrea of type *v1alpha1.PackageInstall to be up and runningWaiting for resource vsphere-cpi of type *v1alpha1.PackageInstall to be up and runningWaiting for resource vsphere-csi of type *v1alpha1.PackageInstall to be up and runningWaiting for resource metrics-server of type *v1alpha1.PackageInstall to be up and runningWaiting for resource tanzu-addons-manager of type *v1alpha1.PackageInstall to be up and runningSuccessfully reconciled package: antreaSuccessfully reconciled package: vsphere-csiSuccessfully reconciled package: metrics-serverContext set for management cluster tanzu-control-plan as '</span>tanzu-control-plan-admin@tanzu-control-plan'.Deleting kind cluster: tkg-kind-c7vj6kds0a6sf43e6210Management cluster created<span class="token operator">!</span>You can now create your first workload cluster by running the following:  tanzu cluster create <span class="token punctuation">[</span>name<span class="token punctuation">]</span> -f <span class="token punctuation">[</span>file<span class="token punctuation">]</span>Some addons might be getting installed<span class="token operator">!</span> Check their status by running the following:  kubectl get apps -A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>éƒ¨ç½²å®Œæˆä¹‹åï¼Œå°†ç®¡ç†é›†ç¾¤çš„ kubeconfig æ–‡ä»¶å¤åˆ¶åˆ° kubectl é»˜è®¤çš„ç›®å½•ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># cp $&#123;HOME&#125;/.kube-tkg/config $&#123;HOME&#125;/.kube/config</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç®¡ç†é›†ç¾¤çš„ cluster èµ„æºä¿¡æ¯ï¼Œç®¡ç†é›†ç¾¤çš„ CR é»˜è®¤ä¿å­˜åœ¨äº† tkg-system namespace ä¸‹</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get cluster -A</span>NAMESPACE    NAME                 PHASEtkg-system   tanzu-control-plan   Provisioned<span class="token comment"># ç®¡ç†é›†ç¾¤çš„ machine èµ„æºä¿¡æ¯</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get machine -A</span>NAMESPACE    NAME                                       PROVIDERID                                       PHASE         VERSIONtkg-system   tanzu-control-plan-control-plane-gs4bl     vsphere://4239c450-f621-d78e-3c44-4ac8890c0cd3   Running       v1.21.2+vmware.1tkg-system   tanzu-control-plan-md-0-7cdc97c7c6-kxcnx   vsphere://4239d776-c04c-aacc-db12-3380542a6d03   Provisioned   v1.21.2+vmware.1<span class="token comment"># è¿è¡Œçš„ç»„ä»¶çŠ¶æ€</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get pod -A</span>NAMESPACE                           NAME                                                             READY   STATUS    RESTARTS   AGEcapi-kubeadm-bootstrap-system       capi-kubeadm-bootstrap-controller-manager-6494884869-wlzhx       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m37scapi-kubeadm-control-plane-system   capi-kubeadm-control-plane-controller-manager-857d687b9d-tpznv   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m35scapi-system                         capi-controller-manager-778bd4dfb9-tkvwg                         <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m41scapi-webhook-system                 capi-controller-manager-9995bdc94-svjm2                          <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m41scapi-webhook-system                 capi-kubeadm-bootstrap-controller-manager-68845b65f8-sllgv       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m38scapi-webhook-system                 capi-kubeadm-control-plane-controller-manager-9847c6747-vvz6g    <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m35scapi-webhook-system                 capv-controller-manager-55bf67fbd5-4t46v                         <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m31scapv-system                         capv-controller-manager-587fbf697f-bbzs9                         <span class="token number">2</span>/2     Running   <span class="token number">0</span>          8m31scert-manager                        cert-manager-77f6fb8fd5-8tq6n                                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11mcert-manager                        cert-manager-cainjector-6bd4cff7bb-6vlzx                         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11mcert-manager                        cert-manager-webhook-fbfcb9d6c-qpkbc                             <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11mkube-system                         antrea-agent-5m9d4                                               <span class="token number">2</span>/2     Running   <span class="token number">0</span>          6mkube-system                         antrea-agent-8mpr7                                               <span class="token number">2</span>/2     Running   <span class="token number">0</span>          5m40skube-system                         antrea-controller-5bbcb98667-hklss                               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5m50skube-system                         coredns-8dcb5c56b-ckvb7                                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         coredns-8dcb5c56b-d98hf                                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         etcd-tanzu-control-plan-control-plane-gs4bl                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         kube-apiserver-tanzu-control-plan-control-plane-gs4bl            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         kube-controller-manager-tanzu-control-plan-control-plane-gs4bl   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         kube-proxy-d4wq4                                                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         kube-proxy-nhkgg                                                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11mkube-system                         kube-scheduler-tanzu-control-plan-control-plane-gs4bl            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         kube-vip-tanzu-control-plan-control-plane-gs4bl                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          12mkube-system                         metrics-server-59fcb9fcf-xjznj                                   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          6m29skube-system                         vsphere-cloud-controller-manager-kzffm                           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5m50skube-system                         vsphere-csi-controller-74675c9488-q9h5c                          <span class="token number">6</span>/6     Running   <span class="token number">0</span>          6m31skube-system                         vsphere-csi-node-dmvvr                                           <span class="token number">3</span>/3     Running   <span class="token number">0</span>          6m31skube-system                         vsphere-csi-node-k6x98                                           <span class="token number">3</span>/3     Running   <span class="token number">0</span>          6m31stkg-system                          kapp-controller-6499b8866-xnql7                                  <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10mtkg-system                          tanzu-addons-controller-manager-657c587556-rpbjm                 <span class="token number">1</span>/1     Running   <span class="token number">0</span>          7m58stkg-system                          tanzu-capabilities-controller-manager-6ff97656b8-cq7m7           <span class="token number">1</span>/1     Running   <span class="token number">0</span>          11mtkr-system                          tkr-controller-manager-6bc455b5d4-wm98s                          <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="éƒ¨ç½²æµç¨‹-1"><a href="#éƒ¨ç½²æµç¨‹-1" class="headerlink" title="éƒ¨ç½²æµç¨‹"></a>éƒ¨ç½²æµç¨‹</h3><p>ç»“åˆ <a href="https://github.com/vmware-tanzu/tanzu-framework/blob/main/pkg/v1/tkg/client/init.go">tanzu çš„æºç </a> å’Œéƒ¨ç½²è¾“å‡ºçš„æ—¥å¿—æˆ‘ä»¬å¤§ä½“å¯ä»¥å¾—çŸ¥ï¼Œtanzu ç®¡ç†é›†ç¾¤éƒ¨ç½²å¤§è‡´åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token comment">// https://github.com/vmware-tanzu/tanzu-framework/blob/main/pkg/v1/tkg/client/init.go</span><span class="token comment">// management cluster init step constants</span><span class="token keyword">const</span> <span class="token punctuation">(</span>StepConfigPrerequisite                 <span class="token operator">=</span> <span class="token string">"Configure prerequisite"</span>StepValidateConfiguration              <span class="token operator">=</span> <span class="token string">"Validate configuration"</span>StepGenerateClusterConfiguration       <span class="token operator">=</span> <span class="token string">"Generate cluster configuration"</span>StepSetupBootstrapCluster              <span class="token operator">=</span> <span class="token string">"Setup bootstrap cluster"</span>StepInstallProvidersOnBootstrapCluster <span class="token operator">=</span> <span class="token string">"Install providers on bootstrap cluster"</span>StepCreateManagementCluster            <span class="token operator">=</span> <span class="token string">"Create management cluster"</span>StepInstallProvidersOnRegionalCluster  <span class="token operator">=</span> <span class="token string">"Install providers on management cluster"</span>StepMoveClusterAPIObjects              <span class="token operator">=</span> <span class="token string">"Move cluster-api objects from bootstrap cluster to management cluster"</span><span class="token punctuation">)</span><span class="token comment">// InitRegionSteps management cluster init step sequence</span><span class="token keyword">var</span> InitRegionSteps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">&#123;</span>StepConfigPrerequisite<span class="token punctuation">,</span>StepValidateConfiguration<span class="token punctuation">,</span>StepGenerateClusterConfiguration<span class="token punctuation">,</span>StepSetupBootstrapCluster<span class="token punctuation">,</span>StepInstallProvidersOnBootstrapCluster<span class="token punctuation">,</span>StepCreateManagementCluster<span class="token punctuation">,</span>StepInstallProvidersOnRegionalCluster<span class="token punctuation">,</span>StepMoveClusterAPIObjects<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ConfigPrerequisite å‡†å¤‡é˜¶æ®µï¼Œä¼šä¸‹è½½ <code>tkg-compatibility</code> å’Œ <code>tkg-bom</code> é•œåƒï¼Œç”¨äºæ£€æŸ¥ç¯å¢ƒçš„å…¼å®¹æ€§ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Downloading TKG compatibility <span class="token function">file</span> from <span class="token string">'projects.registry.vmware.com/tkg/framework-zshippable/tkg-compatibility'</span>Downloading the TKG Bill of Materials <span class="token punctuation">(</span>BOM<span class="token punctuation">)</span> <span class="token function">file</span> from <span class="token string">'projects.registry.vmware.com/tkg/tkg-bom:v1.4.0'</span>Downloading the TKr Bill of Materials <span class="token punctuation">(</span>BOM<span class="token punctuation">)</span> <span class="token function">file</span> from <span class="token string">'projects.registry.vmware.com/tkg/tkr-bom:v1.21.2_vmware.1-tkg.1'</span>ERROR <span class="token number">2022</span>/02/06 02:24:46 svType <span class="token operator">!=</span> tvType<span class="token punctuation">;</span> <span class="token assign-left variable">key</span><span class="token operator">=</span>release, <span class="token assign-left variable">st</span><span class="token operator">=</span>map<span class="token punctuation">[</span>string<span class="token punctuation">]</span>interface <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>, <span class="token assign-left variable">tt</span><span class="token operator">=</span><span class="token operator">&lt;</span>nil<span class="token operator">></span>, <span class="token assign-left variable">sv</span><span class="token operator">=</span>map<span class="token punctuation">[</span>version:<span class="token punctuation">]</span>, <span class="token assign-left variable">tv</span><span class="token operator">=</span><span class="token operator">&lt;</span>nil<span class="token operator">></span>CEIP Opt-in status: <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ValidateConfiguration é…ç½®æ–‡ä»¶æ ¡éªŒï¼Œæ ¹æ®å¡«å†™çš„å‚æ•°æ ¡éªŒé…ç½®æ˜¯å¦æ­£ç¡®ï¼Œä»¥åŠæ£€æŸ¥ vCenter å½“ä¸­æœ‰æ— åŒ¹é…çš„è™šæ‹Ÿæœºæ¨¡ç‰ˆï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Validating the pre-requisites<span class="token punctuation">..</span>.vSphere <span class="token number">7.0</span> Environment Detected.You have connected to a vSphere <span class="token number">7.0</span> environment <span class="token function">which</span> does not have vSphere with Tanzu enabled. vSphere with Tanzu includesan integrated Tanzu Kubernetes Grid Service <span class="token function">which</span> turns a vSphere cluster into a platform <span class="token keyword">for</span> running Kubernetes workloads <span class="token keyword">in</span> dedicatedresource pools. Configuring Tanzu Kubernetes Grid Service is <span class="token keyword">done</span> through vSphere HTML5 client.Tanzu Kubernetes Grid Service is the preferred way to consume Tanzu Kubernetes Grid <span class="token keyword">in</span> vSphere <span class="token number">7.0</span> environments. Alternatively you maydeploy a non-integrated Tanzu Kubernetes Grid instance on vSphere <span class="token number">7.0</span>.Deploying TKG management cluster on vSphere <span class="token number">7.0</span> <span class="token punctuation">..</span>.Identity Provider not configured. Some authentication features won't work.Checking <span class="token keyword">if</span> VSPHERE_CONTROL_PLANE_ENDPOINT <span class="token number">192.168</span>.20.94 is already <span class="token keyword">in</span> useSetting up management cluster<span class="token punctuation">..</span>.Validating configuration<span class="token punctuation">..</span>.Using infrastructure provider vsphere:v0.7.10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>GenerateClusterConfiguration ç”Ÿæˆé›†ç¾¤é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Generating cluster configuration<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>SetupBootstrapCluster è®¾ç½® bootstrap é›†ç¾¤ï¼Œç›®å‰é»˜è®¤ä¸º kindã€‚ä¼šè¿è¡Œä¸€ä¸ª docker å®¹å™¨ï¼Œé‡Œé¢å¥—å¨ƒè¿è¡Œç€ä¸€ä¸ª k8s é›†ç¾¤ï¼›è¿™ä¸ª bootstrap k8s é›†ç¾¤åªæ˜¯ä¸´æ—¶è¿è¡Œ cluster-api æ¥éƒ¨ç½²ç®¡ç†é›†ç¾¤ç”¨çš„ï¼Œéƒ¨ç½²å®Œæˆä¹‹å bootstrap é›†ç¾¤ä¹Ÿå°±æ²¡ç”¨äº†ï¼Œä¼šè‡ªåŠ¨åˆ æ‰ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Setting up bootstrapper<span class="token punctuation">..</span>.Fetching configuration <span class="token keyword">for</span> kind <span class="token function">node</span> image<span class="token punctuation">..</span>.kindConfig: <span class="token operator">&amp;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>Cluster kind.x-k8s.io/v1alpha4<span class="token punctuation">&#125;</span>  <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>  map<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>/var/run/docker.sock /var/run/docker.sock <span class="token boolean">false</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span> <span class="token number">0</span>  <span class="token number">100.96</span>.0.0/11 <span class="token number">100.64</span>.0.0/13 <span class="token boolean">false</span> <span class="token punctuation">&#125;</span> map<span class="token punctuation">[</span><span class="token punctuation">]</span> map<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>apiVersion: kubeadm.k8s.io/v1beta2kind: ClusterConfigurationimageRepository: projects.registry.vmware.com/tkgetcd:  local:    imageRepository: projects.registry.vmware.com/tkg    imageTag: v3.4.13_vmware.15dns:  type: CoreDNS  imageRepository: projects.registry.vmware.com/tkg  imageTag: v1.8.0_vmware.5<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>Creating kind cluster: tkg-kind-c7vj6kds0a6sf43e6210Creating cluster <span class="token string">"tkg-kind-c7vj6kds0a6sf43e6210"</span> <span class="token punctuation">..</span>.Ensuring <span class="token function">node</span> image <span class="token punctuation">(</span>projects.registry.vmware.com/tkg/kind/node:v1.21.2_vmware.1<span class="token punctuation">)</span> <span class="token punctuation">..</span>.Pulling image: projects.registry.vmware.com/tkg/kind/node:v1.21.2_vmware.1 <span class="token punctuation">..</span>.Preparing nodes <span class="token punctuation">..</span>.Writing configuration <span class="token punctuation">..</span>.Starting control-plane <span class="token punctuation">..</span>.Installing CNI <span class="token punctuation">..</span>.Installing StorageClass <span class="token punctuation">..</span>.Waiting 2m0s <span class="token keyword">for</span> control-plane <span class="token operator">=</span> Ready <span class="token punctuation">..</span>.Ready after 19sBootstrapper created. Kubeconfig: /root/.kube-tkg/tmp/config_3fkzTCOL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>InstallProvidersOnBootstrapCluster åœ¨ bootstrap é›†ç¾¤ä¸Šå®‰è£… cluste-api ç›¸å…³ç»„ä»¶ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Installing providers on bootstrapper<span class="token punctuation">..</span>.Fetching providers<span class="token comment"># å®‰è£… cert-manager ä¸»è¦æ˜¯ä¸ºäº†ç”Ÿæˆ k8s é›†ç¾¤éƒ¨ç½²æ‰€ä¾èµ–çš„é‚£ä¸€å †è¯ä¹¦</span>Installing cert-manager <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v1.1.0"</span>Waiting <span class="token keyword">for</span> cert-manager to be available<span class="token punctuation">..</span>.Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"cluster-api"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"bootstrap-kubeadm"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-kubeadm-bootstrap-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"control-plane-kubeadm"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-kubeadm-control-plane-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"infrastructure-vsphere"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.7.10"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capv-system"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"cluster-api"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"CoreProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"kubeadm"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"BootstrapProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"kubeadm"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"ControlPlaneProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"vsphere"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"InfrastructureProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.7.10"</span>Waiting <span class="token keyword">for</span> provider infrastructure-vsphereWaiting <span class="token keyword">for</span> provider control-plane-kubeadmWaiting <span class="token keyword">for</span> provider cluster-apiWaiting <span class="token keyword">for</span> provider bootstrap-kubeadmPassed waiting on provider infrastructure-vsphere after <span class="token number">30</span>.185406332sPassed waiting on provider cluster-api after <span class="token number">30</span>.213216243sSuccess waiting on all providers.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>CreateManagementCluster åˆ›å»ºç®¡ç†é›†ç¾¤ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯åˆ›å»ºè™šæ‹Ÿæœºã€åˆå§‹åŒ–èŠ‚ç‚¹ã€è¿è¡Œ kubeadm éƒ¨ç½² k8s é›†ç¾¤ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Start creating management cluster<span class="token punctuation">..</span>.patch cluster object with operation status:<span class="token punctuation">&#123;</span><span class="token string">"metadata"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token string">"annotations"</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token string">"TKGOperationInfo"</span> <span class="token builtin class-name">:</span> <span class="token string">"&#123;<span class="token entity" title="\&quot;">\"</span>Operation<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>Create<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>OperationStartTimestamp<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span>2022-02-06 02:35:34.30219421 +0000 UTC<span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>OperationTimeout<span class="token entity" title="\&quot;">\"</span>:1800&#125;"</span>,<span class="token string">"TKGOperationLastObservedTimestamp"</span> <span class="token builtin class-name">:</span> <span class="token string">"2022-02-06 02:35:34.30219421 +0000 UTC"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>cluster control plane is still being initialized, retryingGetting secret <span class="token keyword">for</span> clusterWaiting <span class="token keyword">for</span> resource tanzu-control-plan-kubeconfig of <span class="token builtin class-name">type</span> *v1.Secret to be up and runningSaving management cluster kubeconfig into /root/.kube/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>InstallProvidersOnRegionalCluster åœ¨ç®¡ç†é›†ç¾¤ä¸Šå®‰è£… cluster-api ç›¸å…³ç»„ä»¶ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Installing providers on management cluster<span class="token punctuation">..</span>.Fetching providersInstalling cert-manager <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v1.1.0"</span>Waiting <span class="token keyword">for</span> cert-manager to be available<span class="token punctuation">..</span>.Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"cluster-api"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"bootstrap-kubeadm"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-kubeadm-bootstrap-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"control-plane-kubeadm"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.3.23"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capi-kubeadm-control-plane-system"</span>Installing <span class="token assign-left variable">Provider</span><span class="token operator">=</span><span class="token string">"infrastructure-vsphere"</span> <span class="token assign-left variable">Version</span><span class="token operator">=</span><span class="token string">"v0.7.10"</span> <span class="token assign-left variable">TargetNamespace</span><span class="token operator">=</span><span class="token string">"capv-system"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"cluster-api"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"CoreProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"kubeadm"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"BootstrapProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"kubeadm"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"ControlPlaneProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.3.23"</span>installed  <span class="token assign-left variable">Component</span><span class="token operator">==</span><span class="token string">"vsphere"</span>  <span class="token assign-left variable">Type</span><span class="token operator">==</span><span class="token string">"InfrastructureProvider"</span>  <span class="token assign-left variable">Version</span><span class="token operator">==</span><span class="token string">"v0.7.10"</span>Waiting <span class="token keyword">for</span> provider control-plane-kubeadmWaiting <span class="token keyword">for</span> provider bootstrap-kubeadmWaiting <span class="token keyword">for</span> provider infrastructure-vsphereWaiting <span class="token keyword">for</span> provider cluster-apiWaiting <span class="token keyword">for</span> resource capv-controller-manager of <span class="token builtin class-name">type</span> *v1.Deployment to be up and runningPassed waiting on provider infrastructure-vsphere after <span class="token number">20</span>.091935635sPassed waiting on provider cluster-api after <span class="token number">20</span>.109419304sSuccess waiting on all providers.Waiting <span class="token keyword">for</span> the management cluster to get ready <span class="token keyword">for</span> move<span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> resource tanzu-control-plan of <span class="token builtin class-name">type</span> *v1alpha3.Cluster to be up and runningWaiting <span class="token keyword">for</span> resources <span class="token builtin class-name">type</span> *v1alpha3.MachineDeploymentList to be up and runningWaiting <span class="token keyword">for</span> resources <span class="token builtin class-name">type</span> *v1alpha3.MachineList to be up and runningWaiting <span class="token keyword">for</span> addons installation<span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> resources <span class="token builtin class-name">type</span> *v1alpha3.ClusterResourceSetList to be up and runningWaiting <span class="token keyword">for</span> resource antrea-controller of <span class="token builtin class-name">type</span> *v1.Deployment to be up and running<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>MoveClusterAPIObjects å°† bootstrap é›†ç¾¤ä¸Š cluster-api ç›¸å…³çš„èµ„æºè½¬ç§»åˆ°ç®¡ç†é›†ç¾¤ä¸Šã€‚è¿™ä¸€æ­¥çš„ç›®çš„æ˜¯ä¸ºäº†è¾¾åˆ° self-hosted è‡ªæ‰˜ç®¡çš„åŠŸèƒ½ï¼šå³ç®¡ç†é›†ç¾¤è‡ªèº«çš„æ‰©ç¼©å®¹ä¹Ÿæ˜¯é€šè¿‡ cluster-api æ¥å®Œæˆï¼Œè¿™æ ·å°±ä¸ç”¨å†ä¾èµ–å…ˆå‰çš„é‚£ä¸ª bootstrap é›†ç¾¤äº†ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Moving all Cluster API objects from bootstrap cluster to management cluster<span class="token punctuation">..</span>.Performing move<span class="token punctuation">..</span>.Discovering Cluster API objectsMoving Cluster API objects <span class="token assign-left variable">Clusters</span><span class="token operator">=</span><span class="token number">1</span>Creating objects <span class="token keyword">in</span> the target clusterDeleting objects from the <span class="token builtin class-name">source</span> clusterContext <span class="token builtin class-name">set</span> <span class="token keyword">for</span> management cluster tanzu-control-plan as <span class="token string">'tanzu-control-plan-admin@tanzu-control-plan'</span><span class="token builtin class-name">.</span>Deleting kind cluster: tkg-kind-c7vj6kds0a6sf43e6210Management cluster created<span class="token operator">!</span>You can now create your first workload cluster by running the following:  tanzu cluster create <span class="token punctuation">[</span>name<span class="token punctuation">]</span> -f <span class="token punctuation">[</span>file<span class="token punctuation">]</span>Some addons might be getting installed<span class="token operator">!</span> Check their status by running the following:  kubectl get apps -A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éƒ¨ç½²å®Œæˆåä¼šåˆ é™¤ bootstrap é›†ç¾¤ï¼Œå› ä¸º bootstrap é›†ç¾¤ä¸­çš„èµ„æºå·²ç»è½¬ç§»åˆ°äº†ç®¡ç†é›†ç¾¤ä¸­ï¼Œå®ƒç»§ç»­å­˜åœ¨çš„æ„ä¹‰ä¸å¤§ã€‚</p><h2 id="éƒ¨ç½²-workload-é›†ç¾¤"><a href="#éƒ¨ç½²-workload-é›†ç¾¤" class="headerlink" title="éƒ¨ç½² workload é›†ç¾¤"></a>éƒ¨ç½² workload é›†ç¾¤</h2><p>ä¸Šé¢æˆ‘ä»¬åªæ˜¯éƒ¨ç½²å¥½äº†ä¸€ä¸ª tanzu ç®¡ç†é›†ç¾¤ï¼Œæˆ‘ä»¬çœŸæ­£çš„å·¥ä½œè´Ÿè½½å¹¶ä¸é€‚åˆè¿è¡Œåœ¨è¿™ä¸ªé›†ç¾¤ä¸Šï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å†éƒ¨ç½²ä¸€ä¸ª workload é›†ç¾¤ï¼Œç±»ä¼¼äº k8s é›†ç¾¤ä¸­çš„ worker èŠ‚ç‚¹ã€‚éƒ¨ç½² workload é›†ç¾¤çš„æ—¶å€™ä¸å†ä¾èµ– bootstrap é›†ç¾¤ï¼Œè€Œæ˜¯ä½¿ç”¨ç®¡ç†é›†ç¾¤ã€‚</p><p>æ ¹æ®å®˜æ–¹æ–‡æ¡£ <a href="https://tanzucommunityedition.io/docs/latest/vsphere-wl-template/">vSphere Workload Cluster Template</a> ä¸­ç»™å‡ºçš„æ¨¡ç‰ˆåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åå†é€šè¿‡ tanzu å‘½ä»¤æ¥éƒ¨ç½²å³å¯ã€‚é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Cluster Pod IP çš„ CIDR</span><span class="token key atrule">CLUSTER_CIDR</span><span class="token punctuation">:</span> 100.96.0.0/11<span class="token comment"># Service çš„ CIDR</span><span class="token key atrule">SERVICE_CIDR</span><span class="token punctuation">:</span> 100.64.0.0/13<span class="token comment"># é›†ç¾¤çš„åç§°</span><span class="token key atrule">CLUSTER_NAME</span><span class="token punctuation">:</span> tanzu<span class="token punctuation">-</span>workload<span class="token punctuation">-</span>cluster<span class="token comment"># é›†ç¾¤çš„ç±»å‹</span><span class="token key atrule">CLUSTER_PLAN</span><span class="token punctuation">:</span> dev<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹çš„ arch</span><span class="token key atrule">OS_ARCH</span><span class="token punctuation">:</span> amd64<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹çš„ OS åç§°</span><span class="token key atrule">OS_NAME</span><span class="token punctuation">:</span> photon<span class="token comment"># é›†ç¾¤èŠ‚ç‚¹ OS ç‰ˆæœ¬</span><span class="token key atrule">OS_VERSION</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token comment"># åŸºç¡€è®¾æ–½èµ„æºçš„æä¾›æ–¹</span><span class="token key atrule">INFRASTRUCTURE_PROVIDER</span><span class="token punctuation">:</span> vsphere<span class="token comment"># cluster, machine ç­‰è‡ªå®šä¹‰èµ„æºåˆ›å»ºçš„ namespace</span><span class="token key atrule">NAMESPACE</span><span class="token punctuation">:</span> default<span class="token comment"># CNI é€‰ç”¨ç±»å‹ï¼Œç›®å‰åº”è¯¥åªæ”¯æŒ VMware è‡ªå®¶çš„ antrea</span><span class="token key atrule">CNI</span><span class="token punctuation">:</span> antrea<span class="token comment"># é›†ç¾¤çš„ VIP</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_ENDPOINT</span><span class="token punctuation">:</span> 192.168.20.95<span class="token comment"># control-plan èŠ‚ç‚¹çš„ç£ç›˜å¤§å°</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_DISK_GIB</span><span class="token punctuation">:</span> <span class="token string">"20"</span><span class="token comment"># control-plan èŠ‚ç‚¹çš„å†…å­˜å¤§å°</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_MEM_MIB</span><span class="token punctuation">:</span> <span class="token string">"8192"</span><span class="token comment"># control-plan èŠ‚ç‚¹çš„ CPU æ ¸å¿ƒæ•°é‡</span><span class="token key atrule">VSPHERE_CONTROL_PLANE_NUM_CPUS</span><span class="token punctuation">:</span> <span class="token string">"4"</span><span class="token comment"># work èŠ‚ç‚¹çš„ç£ç›˜å¤§å°</span><span class="token key atrule">VSPHERE_WORKER_DISK_GIB</span><span class="token punctuation">:</span> <span class="token string">"20"</span><span class="token comment"># work èŠ‚ç‚¹çš„å†…å­˜å¤§å°</span><span class="token key atrule">VSPHERE_WORKER_MEM_MIB</span><span class="token punctuation">:</span> <span class="token string">"4096"</span><span class="token comment"># work èŠ‚ç‚¹çš„ CPU æ ¸å¿ƒæ•°é‡</span><span class="token key atrule">VSPHERE_WORKER_NUM_CPUS</span><span class="token punctuation">:</span> <span class="token string">"2"</span><span class="token comment"># vCenter çš„ Datacenter è·¯å¾„</span><span class="token key atrule">VSPHERE_DATACENTER</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC<span class="token comment"># è™šæ‹Ÿæœºåˆ›å»ºçš„ Datastore è·¯å¾„</span><span class="token key atrule">VSPHERE_DATASTORE</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/datastore/datastore1<span class="token comment"># è™šæ‹Ÿæœºåˆ›å»ºçš„æ–‡ä»¶å¤¹</span><span class="token key atrule">VSPHERE_FOLDER</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/vm/Tanzu<span class="token punctuation">-</span>node<span class="token comment"># è™šæ‹Ÿæœºä½¿ç”¨çš„ç½‘ç»œ</span><span class="token key atrule">VSPHERE_NETWORK</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/network/VM Network<span class="token comment"># è™šæ‹Ÿæœºå…³è”çš„èµ„æºæ± </span><span class="token key atrule">VSPHERE_RESOURCE_POOL</span><span class="token punctuation">:</span> /SH<span class="token punctuation">-</span>IDC/host/Tanzu<span class="token punctuation">-</span>Cluster/Resources<span class="token comment"># vCenter çš„ IP</span><span class="token key atrule">VSPHERE_SERVER</span><span class="token punctuation">:</span> 192.168.20.92<span class="token comment"># vCenter çš„ç”¨æˆ·å</span><span class="token key atrule">VSPHERE_USERNAME</span><span class="token punctuation">:</span> administrator@vsphere.local<span class="token comment"># vCenter çš„å¯†ç ï¼Œä»¥ base64 ç¼–ç </span><span class="token key atrule">VSPHERE_PASSWORD</span><span class="token punctuation">:</span> &lt;encoded<span class="token punctuation">:</span>YWRtaW5AMjAyMA==<span class="token punctuation">></span><span class="token comment"># vCenter çš„è¯ä¹¦æŒ‡çº¹ï¼Œå¯ä»¥é€šè¿‡ govc about.cert -json | jq -r '.ThumbprintSHA1' è·å–</span><span class="token key atrule">VSPHERE_TLS_THUMBPRINT</span><span class="token punctuation">:</span> CB<span class="token punctuation">:</span>23<span class="token punctuation">:</span>48<span class="token punctuation">:</span>E8<span class="token punctuation">:</span>93<span class="token punctuation">:</span>34<span class="token punctuation">:</span>AD<span class="token punctuation">:</span>27<span class="token punctuation">:</span>D8<span class="token punctuation">:</span>FD<span class="token punctuation">:</span>88<span class="token punctuation">:</span>1C<span class="token punctuation">:</span>D7<span class="token punctuation">:</span>08<span class="token punctuation">:</span>4B<span class="token punctuation">:</span>47<span class="token punctuation">:</span>9B<span class="token punctuation">:</span>12<span class="token punctuation">:</span>F4<span class="token punctuation">:</span>E0<span class="token comment"># è™šæ‹Ÿæœºæ³¨å…¥çš„ ssh å…¬é’¥ï¼Œéœ€è¦ç”¨å®ƒæ¥ ssh ç™»å½•é›†ç¾¤èŠ‚ç‚¹</span><span class="token key atrule">VSPHERE_SSH_AUTHORIZED_KEY</span><span class="token punctuation">:</span> ssh<span class="token punctuation">-</span>rsa<span class="token comment"># ä¸€äº›é»˜è®¤å‚æ•°</span><span class="token key atrule">AVI_ENABLE</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">IDENTITY_MANAGEMENT_TYPE</span><span class="token punctuation">:</span> none<span class="token key atrule">ENABLE_AUDIT_LOGGING</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">ENABLE_CEIP_PARTICIPATION</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">TKG_HTTP_PROXY_ENABLED</span><span class="token punctuation">:</span> <span class="token string">"false"</span><span class="token key atrule">DEPLOY_TKG_ON_VSPHERE7</span><span class="token punctuation">:</span> <span class="token string">"true"</span><span class="token comment"># æ˜¯å¦å¼€å¯è™šæ‹Ÿæœºå¥åº·æ£€æŸ¥</span><span class="token key atrule">ENABLE_MHC</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">MHC_UNKNOWN_STATUS_TIMEOUT</span><span class="token punctuation">:</span> 5m<span class="token key atrule">MHC_FALSE_STATUS_TIMEOUT</span><span class="token punctuation">:</span> 12m<span class="token comment"># æ˜¯å¦éƒ¨ç½² vsphere cis ç»„ä»¶</span><span class="token key atrule">ENABLE_DEFAULT_STORAGE_CLASS</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token comment"># æ˜¯å¦å¼€å¯é›†ç¾¤è‡ªåŠ¨æ‰©ç¼©å®¹</span><span class="token key atrule">ENABLE_AUTOSCALER</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>é€šè¿‡ tanzu å‘½ä»¤æ¥éƒ¨ç½² workload é›†ç¾¤</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># tanzu cluster create tanzu-workload-cluster --file tanzu-workload-cluster.yaml</span>Validating configuration<span class="token punctuation">..</span>.Warning: Pinniped configuration not found. Skipping pinniped configuration <span class="token keyword">in</span> workload cluster. Please refer to the documentation to check <span class="token keyword">if</span> you can configure pinniped on workload cluster manuallyCreating workload cluster <span class="token string">'tanzu-workload-cluster'</span><span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> cluster to be initialized<span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> cluster nodes to be available<span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> cluster autoscaler to be available<span class="token punctuation">..</span>.Unable to <span class="token function">wait</span> <span class="token keyword">for</span> autoscaler deployment to be ready. reason: deployments.apps <span class="token string">"tanzu-workload-cluster-cluster-autoscaler"</span> not foundWaiting <span class="token keyword">for</span> addons installation<span class="token punctuation">..</span>.Waiting <span class="token keyword">for</span> packages to be up and running<span class="token punctuation">..</span>.Workload cluster <span class="token string">'tanzu-workload-cluster'</span> created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>éƒ¨ç½²å®Œæˆä¹‹åæŸ¥çœ‹ä¸€ä¸‹é›†ç¾¤çš„ CR ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get cluster</span>NAME                     PHASEtanzu-workload-cluster   Provisioned<span class="token comment"># machine çŠ¶æ€å¤„äº Running è¯´æ˜èŠ‚ç‚¹å·²ç»æ­£å¸¸è¿è¡Œäº†</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get machine</span>NAME                                          PROVIDERID                                       PHASE     VERSIONtanzu-workload-cluster-control-plane-4tdwq    vsphere://423950ac-1c6d-e5ef-3132-77b6a53cf626   Running   v1.21.2+vmware.1tanzu-workload-cluster-md-0-8555bbbfc-74vdg   vsphere://4239b83b-6003-d990-4555-a72ac4dec484   Running   v1.21.2+vmware.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‰©å®¹é›†ç¾¤"><a href="#æ‰©å®¹é›†ç¾¤" class="headerlink" title="æ‰©å®¹é›†ç¾¤"></a>æ‰©å®¹é›†ç¾¤</h2><p>é›†ç¾¤éƒ¨ç½²å¥½ä¹‹åï¼Œå¦‚æœæƒ³å¯¹é›†ç¾¤èŠ‚ç‚¹è¿›è¡Œæ‰©ç¼©å®¹ï¼Œæˆ‘ä»¬å¯ä»¥åƒ deployment çš„ä¸€æ ·ï¼Œåªéœ€è¦ä¿®æ”¹ä¸€äº› CR çš„ä¿¡æ¯å³å¯ã€‚cluster-api ç›¸å…³ç»„ä»¶ä¼š watch åˆ°è¿™äº› CR çš„å˜åŒ–ï¼Œå¹¶æ ¹æ®å®ƒçš„ spec ä¿¡æ¯è¿›è¡Œä¸€ç³»åˆ—è°ƒè°æ“ä½œã€‚å¦‚æœå½“å‰é›†ç¾¤èŠ‚ç‚¹æ•°é‡ä½äºæ‰€å®šä¹‰çš„èŠ‚ç‚¹å‰¯æœ¬æ•°é‡ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹åº”çš„ Provider åˆ›å»ºè™šæ‹Ÿæœºï¼Œå¹¶å¯¹è™šæ‹Ÿæœºè¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå°†å®ƒè½¬æ¢ä¸º k8s é‡Œçš„ä¸€ä¸ª node èµ„æºï¼›</p><h3 id="æ‰©å®¹-control-plan-èŠ‚ç‚¹"><a href="#æ‰©å®¹-control-plan-èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹ control-plan èŠ‚ç‚¹"></a>æ‰©å®¹ control-plan èŠ‚ç‚¹</h3><p>å³æ‰©å®¹ master èŠ‚ç‚¹ï¼Œé€šè¿‡ä¿®æ”¹ <code>KubeadmControlPlane</code> è¿™ä¸ª CR ä¸­çš„ <code>replicas</code> å‰¯æœ¬æ•°å³å¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl scale kcp tanzu-workload-cluster-control-plane --replicas=3</span><span class="token comment"># å¯ä»¥çœ‹åˆ° machine å·²ç»å¤„äº Provisioning çŠ¶æ€ï¼Œè¯´æ˜é›†ç¾¤èŠ‚ç‚¹å¯¹åº”çš„è™šæ‹Ÿæœºæ­£åœ¨åˆ›å»ºä¸­</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get machine</span>NAME                                          PROVIDERID                                       PHASE          VERSIONtanzu-workload-cluster-control-plane-4tdwq    vsphere://423950ac-1c6d-e5ef-3132-77b6a53cf626   Running        v1.21.2+vmware.1tanzu-workload-cluster-control-plane-mkmd2                                                     Provisioning   v1.21.2+vmware.1tanzu-workload-cluster-md-0-8555bbbfc-74vdg   vsphere://4239b83b-6003-d990-4555-a72ac4dec484   Running        v1.21.2+vmware.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰©å®¹-work-èŠ‚ç‚¹"><a href="#æ‰©å®¹-work-èŠ‚ç‚¹" class="headerlink" title="æ‰©å®¹ work èŠ‚ç‚¹"></a>æ‰©å®¹ work èŠ‚ç‚¹</h3><p>æ‰©å®¹ worker èŠ‚ç‚¹ï¼Œé€šè¿‡ä¿®æ”¹ <code>MachineDeployment</code> è¿™ä¸ª CR ä¸­çš„ <code>replicas</code> å‰¯æœ¬æ•°å³å¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl scale md tanzu-workload-cluster-md-0 --replicas=3</span>root@photon-machine <span class="token punctuation">[</span> ~ <span class="token punctuation">]</span><span class="token comment"># kubectl get machine</span>NAME                                          PROVIDERID                                       PHASE     VERSIONtanzu-workload-cluster-control-plane-4tdwq    vsphere://423950ac-1c6d-e5ef-3132-77b6a53cf626   Running   v1.21.2+vmware.1tanzu-workload-cluster-control-plane-mkmd2    vsphere://4239278c-0503-f03a-08b8-df92286bcdd7   Running   v1.21.2+vmware.1tanzu-workload-cluster-control-plane-rt5mb    vsphere://4239c882-2fe5-a394-60c0-616941a6363e   Running   v1.21.2+vmware.1tanzu-workload-cluster-md-0-8555bbbfc-4hlqk   vsphere://42395deb-e706-8b4b-a44f-c755c222575c   Running   v1.21.2+vmware.1tanzu-workload-cluster-md-0-8555bbbfc-74vdg   vsphere://4239b83b-6003-d990-4555-a72ac4dec484   Running   v1.21.2+vmware.1tanzu-workload-cluster-md-0-8555bbbfc-ftmlp   vsphere://42399640-8e94-85e5-c4bd-8436d84966e0   Running   v1.21.2+vmware.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åç»­"><a href="#åç»­" class="headerlink" title="åç»­"></a>åç»­</h2><p>æœ¬æ–‡åªæ˜¯ä»‹ç»äº† tanzu é›†ç¾¤éƒ¨ç½²çš„å¤§ä½“æµç¨‹ï¼Œé‡Œé¢åŒ…å«äº† cluster-api ç›¸å…³çš„æ¦‚å¿µåœ¨æœ¬æ–‡å¹¶æ²¡æœ‰åšæ·±å…¥çš„åˆ†æï¼Œå› ä¸ºå®åœ¨æ˜¯å¤ªå¤æ‚äº† ğŸ˜‚ï¼Œåˆ°ç°åœ¨æˆ‘è¿˜æ˜¯æ²¡å¤ªç†è§£å…¶ä¸­çš„ä¸€äº›åŸç†ï¼Œå› æ­¤åç»­æˆ‘å†å•ç‹¬å†™ä¸€ç¯‡åšå®¢æ¥è®²è§£ä¸€äº› cluster-api ç›¸å…³çš„å†…å®¹ï¼Œåˆ°é‚£æ—¶å€™åœ¨ç»“åˆæœ¬æ–‡æ¥çœ‹å°±å®¹æ˜“ç†è§£å¾ˆå¤šã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/vmware-tanzu/community-edition">community-edition</a></li><li><a href="https://github.com/vmware/photon">vmware&#x2F;photon</a></li><li><a href="https://github.com/vmware-tanzu/tanzu-framework/blob/main/pkg/v1/tkg/client/init.go">tanzu-framework</a></li><li><a href="https://github.com/kubernetes-sigs/cluster-api-provider-vsphere">cluster-api-provider-vsphere</a></li><li><a href="https://tanzucommunityedition.io/docs/latest/workload-clusters/">Deploying a workload cluster</a></li><li><a href="https://tanzucommunityedition.io/docs/latest/verify-deployment/">Examine the Management Cluster Deployment</a></li><li><a href="https://tanzucommunityedition.io/docs/latest/vsphere/">Prepare to Deploy a Management or Standalone Clusters to vSphere</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ä¹‹å‰æ¥è§¦çš„ Kubernetes
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="ESXi" scheme="https://blog.k8s.li/tags/ESXi/"/>
    
      <category term="Tanzu" scheme="https://blog.k8s.li/tags/Tanzu/"/>
    
      <category term="Kubernetes" scheme="https://blog.k8s.li/tags/Kubernetes/"/>
    
      <category term="Cluster-api" scheme="https://blog.k8s.li/tags/Cluster-api/"/>
    
  </entry>
  
  <entry>
    <title>ä½¿ç”¨ overlay2 æˆ– bind é‡æ–°æ„å»º ISO é•œåƒ</title>
    <link href="https://blog.k8s.li/2022-01-25-rebuild-iso-image.html"/>
    <id>https://blog.k8s.li/2022-01-25-rebuild-iso-image.html</id>
    <published>2022-01-24T16:00:00.000Z</published>
    <updated>2022-01-25T16:00:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>ç¬”è€…ä¹‹å‰åœ¨å­—èŠ‚è·³åŠ¨çš„æ—¶å€™æ˜¯è´Ÿè´£ PaaS å®¹å™¨äº‘å¹³å°çš„ç§æœ‰åŒ–éƒ¨ç½²ç›¸å…³çš„å·¥ä½œï¼Œæ‰€ä»¥ç»å¸¸ä¼šå’Œä¸€äº›å®¹å™¨é•œåƒæ‰“äº¤é“ï¼Œå¯¹å®¹å™¨é•œåƒä¹Ÿæœ‰ä¸€äº›ç ”ç©¶ï¼Œä¹‹å‰è¿˜å†™è¿‡ä¸å°‘åšå®¢æ–‡ç« ã€‚æ¯”å¦‚ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿ ğŸ¤”</a>ã€<a href="https://blog.k8s.li/overlay2-on-package-pipline.html">overlay2 åœ¨æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ä¸­çš„åº”ç”¨</a> ç­‰ç­‰ã€‚</p><p>è‡ªä»æ¢äº†æ–°å·¥ä½œä¹‹åï¼Œåˆ™å¼€å§‹è´Ÿè´£ <a href="https://www.smartx.com/smartx-hci/">è¶…èåˆäº§å“</a> é›†ç¾¤éƒ¨ç½²ç›¸å…³å·¥ä½œï¼Œå› æ­¤ä¹Ÿä¼šæ¥è§¦å¾ˆå¤š <code>é•œåƒ</code>ï¼Œä¸è¿‡è¿™ä¸ªé•œåƒæ˜¯æ“ä½œç³»ç»Ÿçš„ ISO é•œåƒè€Œä¸æ˜¯å®¹å™¨é•œåƒ ğŸ˜‚ã€‚è™½ç„¶ä¸¤è€…éƒ½ç»Ÿç§°ä¸ºé•œåƒï¼Œä½†ä¸¤è€…æœ‰ç€æœ¬è´¨çš„åŒºåˆ«ã€‚</p><p>é¦–å…ˆä¸¤è€…æ„å»ºçš„æ–¹å¼æœ‰æœ¬è´¨çš„å¾ˆå¤§çš„åŒºåˆ«ï¼ŒISO é•œåƒä¸€èˆ¬ä½¿ç”¨ <code>mkisofs</code> æˆ–è€… <code>genisoimage</code> ç­‰å‘½ä»¤å°†ä¸€ä¸ªåŒ…å«æ“ä½œç³»ç»Ÿå®‰è£…æ‰€æœ‰æ–‡ä»¶ç›®å½•æ„å»ºä¸ºä¸€ä¸ª ISO é•œåƒï¼›è€Œå®¹å™¨é•œåƒæ„å»ºåˆ™æ˜¯æ ¹æ® <code>Dockerfile</code> æ–‡ä»¶ä½¿ç”¨ç›¸åº”çš„å®¹å™¨é•œåƒæ„å»ºå·¥å…·æ¥ä¸€å±‚ä¸€å±‚æ„å»ºï¼›</p><p>å¦å¤– ISO é•œåƒæŒ‚è½½åæ˜¯åªè¯»çš„ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœæƒ³è¦ä¿®æ”¹ ISO é•œåƒä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼ˆæ¯”å¦‚ kickstart æ–‡ä»¶ï¼‰ï¼Œåˆ™éœ€è¦å…ˆå°† ISO é•œåƒä¸­çš„æ‰€æœ‰å†…å®¹è´Ÿè´£åˆ°ä¸€ä¸ªå¯ä»¥è¯»å†™çš„ç›®å½•ä¸­ï¼Œåœ¨è¿™ä¸ªè¯»å†™çš„ç›®å½•ä¸­è¿›è¡Œä¿®æ”¹å’Œé‡æ–°æ„å»º ISO æ“ä½œã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># mount -o loop CentOS-7-x86_64-Minimal-2009.iso /mnt/iso</span>mount: /mnt/iso: WARNING: device write-protected, mounted read-only.â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># touch /mnt/iso/kickstart.cfg</span>touch: cannot <span class="token function">touch</span> <span class="token string">'/mnt/iso/kickstart.cfg'</span><span class="token builtin class-name">:</span> Read-only <span class="token function">file</span> system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ç»å¸¸ä¼šå¯¹ä¸€äº›å·²æœ‰çš„ ISO é•œåƒè¿›è¡Œé‡æ–°æ„å»ºï¼Œé‡æ–°æ„å»º ISO çš„æ•ˆç‡æ ¹æ®ä¸åŒçš„æ–¹å¼ä¹Ÿä¼šæœ‰æ‰€ä¸åŒï¼Œæœ¬æ–‡å°±æ•´ç†äº†ä¸‰ç§ä¸åŒé‡æ–°æ„å»º ISO é•œåƒçš„æ–¹æ¡ˆä¾›å¤§å®¶å‚è€ƒã€‚</p><h2 id="å¸¸è§„æ–¹å¼"><a href="#å¸¸è§„æ–¹å¼" class="headerlink" title="å¸¸è§„æ–¹å¼"></a>å¸¸è§„æ–¹å¼</h2><p>ä»¥ä¸‹æ˜¯æŒ‰ç…§ RedHat å®˜æ–¹æ–‡æ¡£ <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/anaconda_customization_guide/sect-iso-images"> WORKING WITH ISO IMAGES</a> ä¸­çš„æ“ä½œæ­¥éª¤è¿›è¡Œ ISO é‡æ–°æ„å»ºã€‚</p><ul><li>é¦–å…ˆæˆ‘ä»¬ä¸‹è½½ä¸€ä¸ª ISO æ–‡ä»¶ï¼Œè¿™é‡Œä»¥ <a href="https://mirrors.tuna.tsinghua.edu.cn/centos/7.9.2009/isos/x86_64/CentOS-7-x86_64-Minimal-2009.iso">CentOS-7-x86_64-Minimal-2009.iso</a> ä¸ºä¾‹ï¼Œä¸‹è½½å¥½ä¹‹åå°†å®ƒæŒ‚è½½åˆ°æœ¬åœ° <code>/mn/iso</code> ç›®å½•ä¸‹ï¼›</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># mount -o loop CentOS-7-x86_64-Minimal-2009.iso /mnt/iso</span>mount: /mnt/iso: WARNING: device write-protected, mounted read-only.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>å°† ISO é‡Œçš„æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># rsync -avrut --force /mnt/iso/ /mnt/build/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>è¿›å…¥åˆ°è¯¥ç›®å½•ä¸‹ä¿®æ”¹æˆ–æ–°å¢æ–‡ä»¶ï¼Œç„¶åé‡æ–°æ„å»º ISO é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ä½¿ç”¨ genisoimage å‘½ä»¤æ„å»º ISO é•œåƒï¼Œåœ¨ CentOS ä¸Šå¯ä»¥ä½¿ç”¨ mkisofs å‘½ä»¤ï¼Œå‚æ•°ä¸Šä¼šæœ‰ä¸€äº›å·®å¼‚</span>â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># genisoimage -U -r -v -T -J -joliet-long -V "CentOS 7 x86_64" -volset "CentOS 7 x86_64" -A "CentOS 7 x86_64" -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -no-emul-boot -o /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso .</span>Total translation table size: <span class="token number">124658</span>Total rockridge attributes bytes: <span class="token number">55187</span>Total directory bytes: <span class="token number">100352</span>Path table size<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>: <span class="token number">140</span>Done with: The File<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                             Block<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token number">527985</span>Writing:   Ending Padblock                         Start Block <span class="token number">528101</span>Done with: Ending Padblock                         Block<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token number">150</span>Max brk space used a4000<span class="token number">528251</span> extents written <span class="token punctuation">(</span><span class="token number">1031</span> MB<span class="token punctuation">)</span><span class="token comment"># ç»™ ISO é•œåƒç”Ÿæˆ md5 æ ¡éªŒ</span>â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># implantisomd5 /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso</span>Inserting md5sum into iso image<span class="token punctuation">..</span>.md5 <span class="token operator">=</span> 9ddf5277bcb1d8679c367dfa93f9b162Inserting fragment md5sums into iso image<span class="token punctuation">..</span>.fragmd5 <span class="token operator">=</span> f39e2822ec1ae832a69ae399ea4bd3e891eeb31e9deb9c536f529c15bbebfrags <span class="token operator">=</span> <span class="token number">20</span>Setting supported flag to <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº ISO é•œåƒæ¯”è¾ƒå°æˆ–è€…è¯¥æ“ä½œä¸æ˜¯å¾ˆé¢‘ç¹çš„æƒ…å†µä¸‹æŒ‰ç…§è¿™ç§æ–¹å¼æ˜¯æœ€çœäº‹å„¿çš„ï¼Œä½†å¦‚æœæ˜¯ ISO é•œåƒæ¯”è¾ƒå¤§ï¼Œæˆ–è€…æ˜¯åœ¨ CI&#x2F;CD æµæ°´çº¿ä¸­é¢‘ç¹åœ°é‡æ–°æ„å»ºé•œåƒï¼Œæ¯æ¬¡éƒ½è¦ cp å¤åˆ¶åŸ ISO é•œåƒçš„å†…å®¹ç¡®å®æ¯”è¾ƒæµªè´¹æ—¶é—´ã€‚é‚£æœ‰æ²¡æœ‰ä¸€ä¸ªæ›´åŠ é«˜æ•ˆçš„æ–¹æ³•å‘¢ ğŸ¤”ï¸</p><p>ç»è¿‡ä¸€ç•ªæ‘¸ç´¢ï¼ŒæŠ˜è…¾å‡ºæ¥ä¸¤ç§å¯ä»¥é¿å…ä½¿ç”¨ cp å¤åˆ¶è¿™ç§å ç”¨å¤§é‡ IO æ“ä½œçš„æ„å»ºæ–¹æ¡ˆï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚</p><h2 id="overlay2"><a href="#overlay2" class="headerlink" title="overlay2"></a>overlay2</h2><p>ç†Ÿæ‚‰ docker é•œåƒçš„åº”è¯¥éƒ½çŸ¥é“é•œåƒæ˜¯åªè¯»çš„ï¼Œä½¿ç”¨é•œåƒçš„æ—¶å€™åˆ™æ˜¯é€šè¿‡è”åˆæŒ‚è½½çš„æ–¹å¼å°†é•œåƒçš„æ¯ä¸€å±‚ layer æŒ‚è½½ä¸ºåªè¯»å±‚ï¼Œå°†å®¹å™¨å®é™…è¿è¡Œçš„ç›®å½•æŒ‚è½½ä¸ºè¯»å†™å±‚ï¼Œè€Œå®¹å™¨è¿è¡ŒæœŸé—´åœ¨è¯»å†™å±‚çš„æ‰€æœ‰æ“ä½œä¸ä¼šå½±å“åˆ°é•œåƒåŸæœ‰çš„å†…å®¹ã€‚å®¹å™¨é•œåƒæŒ‚è½½çš„æ–¹å¼ä½¿ç”¨æœ€å¤šçš„æ˜¯ overlay2 æŠ€æœ¯ï¼Œåœ¨ <a href="https://blog.k8s.li/overlay2-on-package-pipline.html">overlay2 åœ¨æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ä¸­çš„åº”ç”¨</a> å’Œ <a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿ ğŸ¤”</a> ä¸­å’±æ›¾å¯¹å®ƒè¿›è¡Œè¿‡æ¯”è¾ƒæ·±å…¥çš„ç ”ç©¶å’Œä½¿ç”¨ï¼Œå¯¹ overlay2 æŠ€æœ¯æ„Ÿå…´è¶£çš„å¯ä»¥ç¿»çœ‹ä¸€ä¸‹è¿™ä¸¤ç¯‡åšå®¢ï¼Œæœ¬æ–‡å°±ä¸å†è¯¦è§£å…¶ä¸­çš„æŠ€æœ¯åŸç†äº†ï¼Œåªå¯¹ä½¿ç”¨ overlay2 æŠ€æœ¯é‡æ–°æ„å»º ISO é•œåƒçš„å¯è¡Œæ€§è¿›è¡Œä¸€ä¸‹åˆ†æã€‚</p><ul><li>é¦–å…ˆæ˜¯åˆ›å»º overlay2 æŒ‚è½½æ‰€éœ€è¦çš„å‡ ä¸ªç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~â•°â”€<span class="token comment"># mkdir -p /mnt/overlay2/&#123;lower,upper,work,merged&#125;</span>â•­â”€root@esxi-debian-devbox ~â•°â”€<span class="token comment"># cd /mnt/overlay2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¥ç€å°† ISO é•œåƒæŒ‚è½½åˆ° overlay2 çš„åªè¯»å±‚ <code>lower</code> ç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/overlay2â•°â”€<span class="token comment"># mount -o loop  /root/build/CentOS-7-x86_64-Minimal-2009.iso lower</span>mount: /mnt/overlay2/lower: WARNING: device write-protected, mounted read-only.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>ä½¿ç”¨ mount å‘½ä»¤æŒ‚è½½ overlay2 æ–‡ä»¶ç³»ç»Ÿï¼ŒæŒ‚è½½ç‚¹ä¸º <code>merged</code> ç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/overlay2â•°â”€<span class="token comment"># mount -t overlay overlay -o lowerdir=lower,upperdir=upper,workdir=work merged</span>â•­â”€root@esxi-debian-devbox /mnt/overlay2â•°â”€<span class="token comment"># cd merged</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ–°å¢ä¸€ä¸ª kickstart.cfg æ–‡ä»¶ï¼Œç„¶åé‡æ–°æ„å»º ISO é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/overlay2/mergedâ•°â”€<span class="token comment"># echo '# this is a kickstart config file' > kickstart.cfg</span>â•­â”€root@esxi-debian-devbox /mnt/overlay2/mergedâ•°â”€<span class="token comment"># genisoimage -U -r -v -T -J -joliet-long -V "CentOS 7 x86_64" -volset "CentOS 7 x86_64" -A "CentOS 7 x86_64" -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -no-emul-boot -o /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso .</span>Total translation table size: <span class="token number">124658</span>Total rockridge attributes bytes: <span class="token number">55187</span>Total directory bytes: <span class="token number">100352</span>Path table size<span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>: <span class="token number">140</span>Done with: The File<span class="token punctuation">(</span>s<span class="token punctuation">)</span>                             Block<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token number">527985</span>Writing:   Ending Padblock                         Start Block <span class="token number">528101</span>Done with: Ending Padblock                         Block<span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token number">150</span>Max brk space used a4000<span class="token number">528251</span> extents written <span class="token punctuation">(</span><span class="token number">1031</span> MB<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æŒ‚è½½æ–°çš„ ISO é•œåƒéªŒè¯åå‘ç°ç¡®å®å¯è¡Œ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/overlay2/mergedâ•°â”€<span class="token comment"># mount -o loop /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso /mnt/newiso</span>mount: /mnt/newiso: WARNING: device write-protected, mounted read-only.â•­â”€root@esxi-debian-devbox /mnt/overlay2/mergedâ•°â”€<span class="token comment"># cat /mnt/newiso/kickstart.cfg</span><span class="token comment"># this is a kickstart config file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="mount-â€“bind"><a href="#mount-â€“bind" class="headerlink" title="mount â€“bind"></a>mount â€“bind</h2><p>å‰é¢è®²åˆ°äº†ä½¿ç”¨ overlay2 çš„æ–¹å¼é¿å…å¤åˆ¶åŸé•œåƒå†…å®¹è¿›è¡Œé‡æ–°æ„å»ºé•œåƒçš„æ–¹æ¡ˆï¼Œä½†æ˜¯ overlay2 å¯¹äºä¸æ˜¯å¾ˆç†Ÿæ‚‰çš„äººæ¥è®²è¿˜æ˜¯æ¯”è¾ƒå¤æ‚ï¼Œå…‰ lowerdirã€upperdirã€workdirã€mergeddir è¿™å››ä¸ªæ–‡ä»¶å¤¹çš„ä½œç”¨å’ŒåŸç†å°±æŠŠäººç›´æ¥ç»™æ•´ä¸ä¼šäº†ã€‚é‚£ä¹ˆè¿˜æœ‰æ²¡æœ‰æ›´ä¸ºç®€å•ä¸€ç‚¹çš„æ–¹å¼å‘¢ï¼Ÿ</p><p>åˆ«è¯´è¿˜çœŸæœ‰ï¼Œåªä¸è¿‡è¿™ç§æ–¹å¼çš„ç”¨é€”æ¯”è¾ƒå±€é™ã€‚å¦‚æœä»…ä»…æ˜¯ç”¨äºä¿®æ”¹ ISO ä¸­çš„ä¸€ä¸ªæ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œå¯ä»¥å°†è¯¥æ–‡ä»¶æˆ–ç›®å½•ä»¥ <code>bind</code> æŒ‚è½½çš„æ–¹å¼å°†å®ƒæŒ‚è½½åˆ° ISO ç›®å½•ç›®å½•å¯¹åº”çš„æ–‡ä»¶ä¸Šã€‚</p><p>åŸç†å°±æ˜¯è™½ç„¶ ISO ç›®å½•æœ¬èº«æ˜¯åªè¯»çš„ï¼Œä½†å®ƒé‡Œé¢çš„æ–‡ä»¶å’Œç›®å½•æ˜¯å¯ä»¥ä½œä¸ºä¸€ä¸ªæŒ‚è½½ç‚¹çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘æŠŠæ–‡ä»¶ A æŒ‚è½½åˆ°æ–‡ä»¶ Bï¼Œå¹¶ä¸æ˜¯åœ¨ä¿®æ”¹æ–‡ä»¶ Bï¼Œè¿™å°±æ˜¯ Unix&#x2F;Linux æ–‡ä»¶ç³»ç»Ÿååˆ†å¥‡å¦™çš„åœ°æ–¹ã€‚åŒæ ·è¿ç”¨ bind æŒ‚è½½çš„è¿˜æœ‰ docker çš„ volume ä»¥åŠ pod çš„ volume ä¹Ÿæ˜¯è¿ç”¨åŒæ ·çš„åŸç†ï¼Œä»¥ bind çš„æ–¹å¼å°†å®¿ä¸»æœºä¸Šçš„ç›®å½•æˆ–æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨è¿è¡Œå¯¹åº”çš„ç›®å½•ä¸Šã€‚å¯¹äºä¿®æ”¹åªè¯» ISO é‡Œçš„æ–‡ä»¶&#x2F;ç›®å½•æˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥è¿™æ ·åšã€‚åºŸè¯ä¸å¤šè¯´æ¥å®è·µéªŒè¯ä¸€ä¸‹ï¼š</p><ul><li>é¦–å…ˆä¾æ—§æ˜¯å°† ISO é•œåƒæŒ‚è½½åˆ° <code>/mn/iso</code> ç›®å½•</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># mount -o loop CentOS-7-x86_64-Minimal-2009.iso /mnt/iso</span>mount: /mnt/iso: WARNING: device write-protected, mounted read-only.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ¥ç€åˆ›å»ºä¸€ä¸ª <code>/mnt/files/ks.cfg</code> æ–‡ä»¶ï¼Œå¹¶å†™å…¥æˆ‘ä»¬éœ€è¦çš„å†…å®¹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># mkdir -p /mnt/files</span>â•­â”€root@esxi-debian-devbox ~/buildâ•°â”€<span class="token comment"># echo '# this is a kickstart config file' > /mnt/files/ks.cfg</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ¥ç€ä»¥ mount â€“bind çš„æ–¹å¼æŒ‚è½½æ–°å»ºçš„æ–‡ä»¶åˆ° ISO çš„ EULA æ–‡ä»¶</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/buildâ•°â”€<span class="token comment"># mount --bind /mnt/files/ks.cfg /mnt/iso/EULA</span>â•­â”€root@esxi-debian-devbox /mnt/buildâ•°â”€<span class="token comment"># cat /mnt/iso/EULA</span><span class="token comment"># this is a kickstart config file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯ä»¥çœ‹åˆ°åŸæ¥ ISO æ–‡ä»¶ä¸­çš„ EULA æ–‡ä»¶å·²ç»è¢«æˆåŠŸæ›¿æ¢æˆäº†æˆ‘ä»¬ä¿®æ”¹çš„æ–‡ä»¶ï¼Œç„¶åå†é‡æ–°æ„å»ºä¸€ä¸‹è¯¥ ISO é•œåƒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/isoâ•°â”€<span class="token comment"># genisoimage -U -r -v -T -J -joliet-long -V "CentOS 7 x86_64" -volset "CentOS 7 x86_64" -A "CentOS 7 x86_64" -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -no-emul-boot -o /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso .</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ç„¶åæˆ‘ä»¬å†é‡æ–°æŒ‚è½½æ–°çš„ ISO æ–‡ä»¶éªŒè¯ä¸€ä¸‹æ˜¯å¦å¯ä»¥</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â•­â”€root@esxi-debian-devbox /mnt/isoâ•°â”€<span class="token comment"># mkdir /mnt/newiso</span>â•­â”€root@esxi-debian-devbox /mnt/isoâ•°â”€<span class="token comment"># mount -o loop /mnt/CentOS-7-x86_64-Minimal-2009-dev.iso /mnt/newiso</span>mount: /mnt/newiso: WARNING: device write-protected, mounted read-only.â•­â”€root@esxi-debian-devbox /mnt/isoâ•°â”€<span class="token comment"># cat /mnt/newiso/EULA</span><span class="token comment"># this is a kickstart config file</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>éªŒè¯é€šè¿‡ï¼Œç¡®å®å¯ä»¥ï¼ä¸è¿‡è¿™ç§æ–¹å¼å¾ˆå±€é™ï¼Œæ¯”è¾ƒé€‚ç”¨äºä¿®æ”¹å•ä¸ªæ–‡ä»¶å¦‚ <code>kickstart.cfg</code>ï¼Œå¦‚æœæ˜¯è¦æ–°å¢æ–‡ä»¶é‚£è¿˜æ˜¯ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ overlay2 çš„æ–¹å¼æ›´ä¸ºæ–¹ä¾¿ä¸€äº›ã€‚</p><h2 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h2><p>è™½ç„¶ ISO é•œåƒå’Œå®¹å™¨é•œåƒäºŒè€…æœ‰ç€æœ¬è´¨çš„å·®åˆ«ï¼Œä½†å¯¹äºåªè¯»å’Œè”åˆæŒ‚è½½çš„è¿™äº›ç‰¹æ€§äºŒè€…å¯ä»¥ç›¸äº’å€Ÿé‰´æ»´ã€‚</p><p>ä¸æ­¢å¦‚æ­¤ overlay2 è¿™ç§è”åˆæŒ‚è½½çš„ç‰¹æ€§ï¼Œè¿˜å¯ä»¥ç”¨åœ¨å…¶ä»–åœ°æ–¹ã€‚æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ªå…¬å…±çš„ NFS å…±äº«æœåŠ¡å™¨ï¼Œå…±äº«ç€ä¸€äº›ç›®å½•ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥ä»¥ root ç”¨æˆ·å¹¶ä»¥è¯»å†™çš„æƒé™è¿›è¡Œ NFS æŒ‚è½½ã€‚è¿™ç§æƒ…å†µä¸‹å¾ˆéš¾ä¿éšœä¸€äº›é‡è¦çš„æ–‡ä»¶å’Œæ•°æ®è¢«è¯¯åˆ ã€‚è¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨ overlay2 çš„æ–¹å¼å°†ä¸€äº›é‡è¦çš„æ–‡ä»¶æ•°æ®æŒ‚è½½ä¸º overlay2 çš„ lowerdir åªè¯»å±‚ï¼Œä¿è¯è¿™äº›æ•°æ®å°±å¦‚å®¹å™¨é•œåƒä¸€æ ·ï¼Œæ¯æ¬¡æŒ‚è½½ä½¿ç”¨çš„æ—¶å€™éƒ½ä½œä¸ºä¸€ä¸ªåªè¯»å±‚ã€‚æ‰€æœ‰çš„è¯»å†™æ“ä½œéƒ½åœ¨ overlay2 çš„ merged é‚£ä¸€å±‚ï¼Œä¸ä¼šçœŸæ­£å½±å“åˆ°åªè¯»å±‚çš„å†…å®¹ã€‚</p><p>è‰è‰åœ°æ°´äº†ä¸€ç¯‡åšå®¢ï¼Œæ˜¯ä¸æ˜¯æ²¡æœ‰ç”¨çš„çŸ¥è¯†åˆå¢åŠ äº† ğŸ˜‚</p><h2 id="æ¨èé˜…è¯»"><a href="#æ¨èé˜…è¯»" class="headerlink" title="æ¨èé˜…è¯»"></a>æ¨èé˜…è¯»</h2><ul><li><a href="https://www.kernel.org/doc/Documentation/filesystems/overlayfs.txt">overlayfs.txt</a></li><li><a href="https://arkingc.github.io/2017/05/05/2017-05-05-docker-filesystem-overlay/">Docker å­˜å‚¨é©±åŠ¨â€”Overlay&#x2F;Overlay2ã€Œè¯‘ã€</a></li><li><a href="https://blog.k8s.li/Exploring-container-image.html">æ·±å…¥æµ…å‡ºå®¹å™¨é•œåƒçš„ä¸€ç”Ÿ ğŸ¤”</a></li><li><a href="https://zdyxry.github.io/2019/01/12/%E8%81%8A%E4%B8%80%E8%81%8A-ISO-9660/">èŠä¸€èŠ ISO 9660</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/anaconda_customization_guide/sect-iso-images">WORKING WITH ISO IMAGES</a></li><li><a href="https://blog.k8s.li/overlay2-on-package-pipline.html">overlay2 åœ¨æ‰“åŒ…å‘å¸ƒæµæ°´çº¿ä¸­çš„åº”ç”¨</a></li><li><a href="https://blog.k8s.li/mount-bind.html">mount å‘½ä»¤ä¹‹ â€“bind æŒ‚è½½å‚æ•°</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;ç¬”è€…ä¹‹å‰åœ¨å­—èŠ‚è·³åŠ¨çš„æ—¶å€™æ˜¯è´Ÿè´£ PaaS
        
      
    
    </summary>
    
    
      <category term="æŠ€æœ¯" scheme="https://blog.k8s.li/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="overlay2" scheme="https://blog.k8s.li/tags/overlay2/"/>
    
      <category term="ISO" scheme="https://blog.k8s.li/tags/ISO/"/>
    
  </entry>
  
  <entry>
    <title>Kubespray 2.18 ç‰ˆæœ¬ç‰¹æ€§é¢„è§ˆ</title>
    <link href="https://blog.k8s.li/2022-01-05-kubespray-2.18.html"/>
    <id>https://blog.k8s.li/2022-01-05-kubespray-2.18.html</id>
    <published>2022-01-04T16:00:00.000Z</published>
    <updated>2022-05-30T15:01:49.551Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘ kubernetes-sig ç¤¾åŒºçš„ <a href="https://github.com/kubernetes-sigs/kubespray">kubespray</a> é¡¹ç›®æ­£å¼ release äº† <a href="https://github.com/kubernetes-sigs/kubespray/releases/tag/v2.18.0">v2.18.0</a> ç‰ˆæœ¬ï¼ŒåŒæ—¶å¯¹åº” <a href="https://github.com/cncf/k8s-conformance">k8s-conformance</a> çš„ <a href="https://github.com/cncf/k8s-conformance/pull/1748">v1.21</a> å’Œ <a href="https://github.com/cncf/k8s-conformance/pull/1760">v1.22</a> ç‰ˆæœ¬ kubespray ä¹Ÿéƒ½å·²ç»å¾—åˆ° CNCF çš„ä¸€è‡´æ€§è®¤è¯ã€‚äºæ˜¯ä»Šå¤©å°±å€Ÿè¿™ä¸ªæ–°ç‰ˆæœ¬ release çš„æœºä¼šæ•´ç†ä¸€ä¸‹ 2.18 ç‰ˆæœ¬çš„ kubespray æœ‰å“ªäº›æœ‰è¶£çš„å˜åŒ–ã€‚</p><h2 id="ç»„ä»¶ç‰ˆæœ¬"><a href="#ç»„ä»¶ç‰ˆæœ¬" class="headerlink" title="ç»„ä»¶ç‰ˆæœ¬"></a>ç»„ä»¶ç‰ˆæœ¬</h2><p>ä»¥ä¸‹æ˜¯ v2.18.0 ç‰ˆæœ¬ä¸­ kubespray éƒ¨ç½²ç»„ä»¶çš„ä¸€äº›ç‰ˆæœ¬ä¿¡æ¯ï¼š</p><h3 id="K8s-æ ¸å¿ƒç»„ä»¶"><a href="#K8s-æ ¸å¿ƒç»„ä»¶" class="headerlink" title="K8s æ ¸å¿ƒç»„ä»¶"></a>K8s æ ¸å¿ƒç»„ä»¶</h3><ul><li>kubespray æ”¯æŒçš„ Kubernetes æ”¯æŒä» v1.22.0 åˆ° v1.23.1 ä¹‹é—´çš„æ‰€æœ‰æ­£å¼ç‰ˆæœ¬ï¼Œé»˜è®¤éƒ¨ç½²çš„ç‰ˆæœ¬ä¸º v1.22.5ï¼Œå¹¶ä¸” <a href="https://github.com/cncf/k8s-conformance/pull/1760">v1.22</a> ç‰ˆæœ¬å¾—åˆ°äº† CNCF å®˜æ–¹çš„ä¸€è‡´æ€§è®¤è¯ï¼›</li><li>etcd ä»åŸæ¥çš„ v3.4.13 å‡çº§åˆ°äº† v3.5.0ï¼›</li><li>coredns ç‰ˆæœ¬å‡çº§åˆ°äº† v1.8.0ï¼Œå®ƒçš„æ­æ¡£ dnsautoscaler åˆ™ä¸º 1.8.5ï¼›</li><li>pod_infra å³ pause é•œåƒçš„ç‰ˆæœ¬æ²¡æœ‰å˜åŒ–ä¾æ—§ä¸º 3.3ï¼›</li></ul><table><thead><tr><th>Addon</th><th align="left">Version</th></tr></thead><tbody><tr><td>kube</td><td align="left">v1.22.5</td></tr><tr><td>pod_infra</td><td align="left">3.3</td></tr><tr><td>etcd</td><td align="left">v3.5.0</td></tr><tr><td>coredns</td><td align="left">v1.8.0</td></tr></tbody></table><h3 id="å®¹å™¨è¿è¡Œæ—¶"><a href="#å®¹å™¨è¿è¡Œæ—¶" class="headerlink" title="å®¹å™¨è¿è¡Œæ—¶"></a>å®¹å™¨è¿è¡Œæ—¶</h3><p>ç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·ä¸­ï¼Œå¯¹å®¹å™¨è¿è¡Œæ—¶çš„æ”¯æŒ kubespray æ— ç–‘æ˜¯æœ€ä¸°å¯Œçš„ã€‚éƒ¨ç½²èƒ½æ”¯æŒ dockerã€containerdã€crunã€kataã€cri-oã€‚é»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶å·²ç»ä»ä¹‹å‰çš„ docker åˆ‡æ¢åˆ°äº† containerdï¼Œcontainerd çš„ç‰ˆæœ¬æ˜¯ v1.5.8ã€‚</p><table><thead><tr><th>Addon</th><th>Version</th></tr></thead><tbody><tr><td>containerd</td><td>1.5.8</td></tr><tr><td>docker</td><td>20.10</td></tr><tr><td>docker_containerd</td><td>1.4.12</td></tr><tr><td>crun</td><td>1.3</td></tr><tr><td>runc</td><td>v1.0.3</td></tr><tr><td>crio</td><td>1.22</td></tr><tr><td>kata_containers</td><td>2.2.3</td></tr><tr><td>gvisor</td><td>20210921</td></tr></tbody></table><h3 id="CNI"><a href="#CNI" class="headerlink" title="CNI"></a>CNI</h3><p>åŒæ ·ï¼Œç›®å‰å¸‚é¢ä¸Šæ‰€æœ‰çš„ Kubernetes é›†ç¾¤éƒ¨ç½²å·¥å…·ä¸­ï¼Œå¯¹ CNI çš„æ”¯æŒ kubespray ä¹Ÿæ— ç–‘æ˜¯æœ€ä¸ºä¸°å¯Œçš„ï¼Œèƒ½æ”¯æŒ 9 ç§ CNI ä»¥åŠå¤šç§ CNI ç»„åˆéƒ¨ç½²çš„ <a href="https://github.com/intel/multus-cni">multus</a> ã€‚</p><table><thead><tr><th>Addon</th><th>Version</th></tr></thead><tbody><tr><td>calico</td><td>v3.20.3</td></tr><tr><td>flannel</td><td>v0.15.1</td></tr><tr><td>flannel_cni</td><td>v1.0.0</td></tr><tr><td>cni</td><td>v1.0.1</td></tr><tr><td>weave</td><td>2.8.1</td></tr><tr><td>cilium</td><td>v1.9.11</td></tr><tr><td>kube_ovn</td><td>v1.8.1</td></tr><tr><td>kube_router</td><td>v1.3.2</td></tr><tr><td>multus_cni</td><td>0.4.0</td></tr><tr><td>multus</td><td>v3.8</td></tr></tbody></table><h3 id="Kubernetes-app"><a href="#Kubernetes-app" class="headerlink" title="Kubernetes-app"></a>Kubernetes-app</h3><p>åŒæ—¶ï¼Œkubespray è¿˜æ”¯æŒä¸€äº› CLI å·¥å…·ä»¥åŠç¬¬ä¸‰æ–¹åº”ç”¨çš„éƒ¨ç½²ã€‚</p><ul><li>CLI å·¥å…·</li></ul><p>ä¸€äº› CLI å·¥å…·ï¼Œæ¯”å¦‚ helmã€nerdctlã€krewã€crictlã€‚å…¶ä¸­ nerdctl çš„éƒ¨ç½²æ”¯æŒæ˜¯å’±åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/7500">#7500</a> ä¸­åŠ å…¥æ”¯æŒçš„ï¼Œç›®çš„æ˜¯ä¸º containerd ç”¨æˆ·æä¾›ä¸€ä¸ªç›¸å¯¹å‹å¥½çš„å‘½ä»¤è¡Œæ“ä½œä½“éªŒï¼Œä»¥æ›¿ä»£ docker CLIã€‚</p><table><thead><tr><th>addon</th><th>version</th></tr></thead><tbody><tr><td>helm</td><td>v3.7.1</td></tr><tr><td>nerdctl</td><td>0.15.0</td></tr><tr><td>krew</td><td>v0.4.2</td></tr><tr><td>crictl</td><td>v1.22.0</td></tr></tbody></table><ul><li>app</li></ul><p>ä¸ªäººæ„Ÿè§‰éƒ¨ç½²ä¸€äº›åƒ <code>dnsautoscaler</code>ã€ <code>argoCD</code> è¿™æ ·çš„åº”ç”¨ï¼Œè¿˜æ˜¯ä½¿ç”¨ helm æ¯”è¾ƒå¥½ã€‚å› ä¸ºåŸºäº ansible çš„ kubespray ç»´æŠ¤è¿™ä¹ˆå¤šç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œä»¥åŠå®ƒä»¬çš„å‡çº§ç®¡ç†éƒ½è¿œä¸å¦‚ helm æ–¹ä¾¿ã€‚å› æ­¤è€ƒè™‘åˆ°è¿™äº›ç»„ä»¶çš„å‡çº§ç»´æŠ¤æˆæœ¬ï¼Œä¸ªäººè¿˜æ˜¯ä¸å¤ªå»ºè®®ä½¿ç”¨ kubespray æ¥éƒ¨ç½²è¿™äº›ç»„ä»¶ã€‚</p><table><thead><tr><th>Addon</th><th>Version</th></tr></thead><tbody><tr><td>dnsautoscaler</td><td>1.8.5</td></tr><tr><td>netcheck</td><td>v1.2.2</td></tr><tr><td>nodelocaldns</td><td>1.21.1</td></tr><tr><td>metrics_server</td><td>v0.5.0</td></tr><tr><td>cert_manager</td><td>v1.5.4</td></tr><tr><td>addon_resizer</td><td>1.8.11</td></tr><tr><td>cinder_blockstorage</td><td>v3</td></tr><tr><td>external_vsphere</td><td>6.7u3</td></tr><tr><td>nvidia_driver</td><td>390.87</td></tr><tr><td>oci_cloud_controller</td><td>0.7.0</td></tr><tr><td>metallb</td><td>v0.10.3</td></tr><tr><td>argocd</td><td>v2.1.6</td></tr></tbody></table><h2 id="æ”¯æŒçš„-OS"><a href="#æ”¯æŒçš„-OS" class="headerlink" title="æ”¯æŒçš„ OS"></a>æ”¯æŒçš„ OS</h2><table><thead><tr><th>distribution</th><th>version</th></tr></thead><tbody><tr><td>Amazon Linux</td><td>2</td></tr><tr><td>Fedora CoreOS</td><td>34.x&#x2F;35.x</td></tr><tr><td>Flatcar Container Linux by Kinvolk</td><td></td></tr><tr><td>Alma Linux</td><td>8</td></tr><tr><td>Rocky Linux</td><td>8</td></tr><tr><td>CentOS&#x2F;RHEL</td><td>7&#x2F;8</td></tr><tr><td>Oracle Linux</td><td>7&#x2F;8</td></tr><tr><td>Debian</td><td>8&#x2F;9&#x2F;10&#x2F;11</td></tr><tr><td>Ubuntu</td><td>16.04&#x2F;18.04&#x2F;20.04</td></tr><tr><td>Fedora</td><td>34&#x2F;35</td></tr><tr><td>openSUSE</td><td>Leap 15.x&#x2F;Tumbleweed</td></tr></tbody></table><h2 id="ä¸»è¦å˜åŒ–"><a href="#ä¸»è¦å˜åŒ–" class="headerlink" title="ä¸»è¦å˜åŒ–"></a>ä¸»è¦å˜åŒ–</h2><h3 id="åºŸé™¤"><a href="#åºŸé™¤" class="headerlink" title="åºŸé™¤"></a>åºŸé™¤</h3><ul><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8086">#8086</a> ä¸­ç§»é™¤äº†å¯¹ Ambassador çš„æ”¯æŒï¼›</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8327">#8327</a> ä¸­ç§»é™¤äº†å¯¹ registry-proxy çš„æ”¯æŒï¼›</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8246">#8246</a> ä¸­ç§»é™¤äº†å¯¹ Fedora 33 çš„æ”¯æŒï¼Œå› ä¸º  Fedora 33 åœ¨ 2021-11-30 å°±å·²ç» EOL äº†ï¼Œæ‰€ä»¥è¢«åºŸå¼ƒæ”¯æŒä¹Ÿç†æ‰€å½“ç„¶ï¼›</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8265">#8265</a> ä¸­ç§»é™¤äº†å¯¹ Mitogen çš„æ”¯æŒï¼ŒMitogen çš„ä½œç”¨å°±æ˜¯ç”¨æ¥ä¼˜åŒ– Ansible çš„æ€§èƒ½ï¼Œä½† Mitogen å¯¹äºä¸€äº›æ–°çš„ Linux å‘è¡Œç‰ˆæ”¯æŒçš„é¢å¹¶ä¸æ˜¯å¾ˆå‹å¥½ï¼Œåœ¨ Kubespray ä¸­ç»´æŠ¤çš„æˆæœ¬ä¹Ÿæ¯”è¾ƒå¤§ï¼Œå› æ­¤ç¤¾åŒºå°±åºŸå¼ƒå®ƒäº†ï¼›</li></ul><h3 id="æ–°ç‰¹æ€§"><a href="#æ–°ç‰¹æ€§" class="headerlink" title="æ–°ç‰¹æ€§"></a>æ–°ç‰¹æ€§</h3><ul><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/7895">#7895</a> ä¸­æ–°å¢äº† ArgoCD çš„éƒ¨ç½²æ”¯æŒï¼Œé€šè¿‡è®¾ç½® <code>argocd_enabled</code> å³å¯åœ¨éƒ¨ç½²é›†ç¾¤çš„æ—¶å€™å®‰è£… ArgoCDã€‚ä¸è¿‡ä¸ªäººè®¤ä¸ºï¼ŒArgoCD è¿™ç©æ„å„¿ä¸å¤ªé€‚åˆæ”¾åœ¨ K8s éƒ¨ç½²å½“ä¸­æ¥ï¼Œçœ‹çœ‹ <a href="https://github.com/kubesphere/ks-installer">ks-installer</a> çš„ä»£ç ä½ å°±èƒ½æ˜ç™½äº† ğŸ˜‚ã€‚</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8175">#8175</a> ä¸­é»˜è®¤ä½¿ç”¨ containerd ä½œä¸ºé»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œæ›¿ä»£æ‰äº† dockerã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å‰ç‰ˆæœ¬çš„ kubespray æ˜¯ä½¿ç”¨ <a href="https://github.com/containerd/containerd">containerd</a> å®˜æ–¹ repo release çš„äºŒè¿›åˆ¶å®‰è£…åŒ…ï¼Œä½†äºŒè¿›åˆ¶å®‰è£…åŒ…å¹¶æ²¡æœ‰ arm64 ç‰ˆæœ¬çš„ã€‚æ‰€ä»¥å¦‚æœè¦éƒ¨ç½²çš„é›†ç¾¤èŠ‚ç‚¹åŒ…å« arm64 çš„æœºå™¨ï¼Œæœ€å¥½è¿˜æ˜¯ä½¿ç”¨ docker ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8291">#8291</a> æ–°å¢äº† registry éƒ¨ç½²æ”¯æŒå¤šç§ ServiceTypes çš„æ”¯æŒï¼›</li><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8229">#8229</a> ä¸­æ–°å¢äº†æ”¯æŒ registry è®¤è¯çš„æ–¹å¼ï¼Œç§æœ‰åŒ–éƒ¨ç½²çš„æ—¶å€™ä½¿ç”¨å¸¦æœ‰è®¤è¯çš„ registry ä¼šç”¨åˆ°ï¼›</li></ul><h3 id="å·²çŸ¥é—®é¢˜"><a href="#å·²çŸ¥é—®é¢˜" class="headerlink" title="å·²çŸ¥é—®é¢˜"></a>å·²çŸ¥é—®é¢˜</h3><ul><li>åœ¨ <a href="https://github.com/kubernetes-sigs/kubespray/pull/8239">#8239</a> ä¸­ <a href="https://github.com/cristicalin">cristicalin</a> å¤§ä½¬å¼•å…¥äº†ä¸€ä¸ªä¿®æ”¹ï¼Œå¦‚æœæ˜¯ containerd è¿è¡Œæ—¶ï¼Œåˆ™ä½¿ç”¨ nerdctl ä¸‹è½½é•œåƒã€‚è¿™å°†ä¼šå¯¼è‡´é…ç½®äº† containerd registry mirrors çš„å‚æ•°å°†ä¼šå¤±æ•ˆã€‚</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;æœ€è¿‘ kubernetes-sig ç¤¾åŒºçš„ &lt;a
        
      
    
    </summary>
    
    
    
  </entry>
  
  <entry>
    <title>æ—¶å…‰ç—•è¿¹ï¼š2021 å¹´æ€»ç»“</title>
    <link href="https://blog.k8s.li/2022-01-02-2021.html"/>
    <id>https://blog.k8s.li/2022-01-02-2021.html</id>
    <published>2022-01-02T16:00:00.000Z</published>
    <updated>2022-05-30T15:01:49.551Z</updated>
    
    <content type="html"><![CDATA[<p>2021 ä¾æ—§æ˜¯äººç±»ç¤¾ä¼š<strong>å€’è½¦å’ŒåŠ é€Ÿç­äº¡</strong>çš„ä¸€å¹´ï¼Œå…¨çƒèŒƒå›´å†…æ–°å† ç—…æ¯’ä¾æ—§åœ¨è‚†è™ï¼Œæ–°çš„å˜å¼‚åˆæ¥è¸µè€Œæ¥ï¼Œç–«æƒ…å¹¶æ²¡æœ‰å¤šå°‘æ¶ˆé€€çš„è¿¹è±¡ã€‚è€Œç°åœ¨å›½å†…è¥¿å®‰ç–«æƒ…åˆçˆ†å‘å¼€æ¥ï¼Œæ— æ³•é¢„æƒ³æœªæ¥ç©¶ç«Ÿèƒ½å˜æˆä»€ä¹ˆæ ·å­ã€‚</p><h2 id="é˜…è¯»"><a href="#é˜…è¯»" class="headerlink" title="é˜…è¯»"></a>é˜…è¯»</h2><p>2021 å¹´ 9 æœˆä»½çš„æ—¶å€™å°†ä¹¦å•ä»åŸæ¥çš„ Markdown æ–‡æœ¬è¿ç§»åˆ°äº† Notion ä¸Šï¼Œä½“éªŒååˆ†æ£’ã€‚Notion çš„è¡¨æ ¼æ•°æ®åº“åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œå¯¹ä¹¦å•æ¥è¯´ç®€ç›´å°±æ˜¯ä¸€ä»¶ç¥å™¨ã€‚æŠ½ç©ºæ•´ç†äº†ä¸€ä¸‹ä¹¦å•  <a href="https://reading.k8s.li/">reading.k8s.li</a>  ï¼Œ2021 å¹´å¤§æ¦‚è¯»å®Œäº† 97 æœ¬ä¹¦ã€‚å…¶ä¸­ç§‘æ™® 27 æœ¬ã€æ¼«ç”» 17 æœ¬ã€å†å² 13 æœ¬ã€æ”¿æ²» 11 æœ¬ã€è½»å°è¯´ 8 æœ¬ã€ç¤¾ç§‘ 7 æœ¬ã€å¿ƒç†å­¦ 5 æœ¬ã€æŠ€æœ¯ 5 æœ¬ã€æ³•å¾‹ 2 æœ¬ã€‚ä¹‹æ‰€ä»¥èƒ½è¯»å®Œè¿™ä¹ˆå¤šä¹¦å¤§æ¦‚æ˜¯å› ä¸ºå¦‚ä¸‹ ğŸ˜‚ï¼š</p><ul><li>å•èº«ç‹¬å±…ï¼Œè‡ªå·±ä¸€ä¸ªäººç”Ÿæ´»ï¼Œæ²¡äººæ‰“æ‰°ï¼›</li><li>ä¸å–œæ¬¢ç¤¾äº¤ï¼Œä¸å–œæ¬¢ç¾¤èŠé—²èŠæ‰¯æ·¡æ’•é€¼ï¼›</li><li>ä¸ç©æ¸¸æˆä¸åˆ·çŸ­è§†é¢‘ï¼Œæ²¡æœ‰å…¶ä»–çˆ±å¥½ï¼›</li><li>å‘¨æœ«å’ŒèŠ‚å‡æ—¥å¤§å¤šæ•°å®…åœ¨å®¶é‡Œç©å„¿ï¼›</li></ul><p>å…¶ä¸­æˆ‘è§‰ç€å•èº«ç‹¬å±…æ˜¯æœ€ä¸»è¦çš„åŸå› ï¼Œæ¯”å¦‚ <a href="https://twitter.com/yihong0618">ä¼Šæ´ª</a> è€å“¥ä¹Ÿæ˜¯å¦‚æ­¤ï¼š</p><p><img src="https://p.k8s.li/image-20220103202406764.png" alt="image-20220103202406764"></p><p>æ ¹æ®ä¸ªäººçš„å–œå¥½ï¼Œå°±åˆ†äº«ä»¥ä¸‹ 10 æœ¬æˆ‘ä¸ªäººè§‰ç€ååˆ†æœ‰æ„æ€çš„ä¹¦ç»™å¤§å®¶ï¼š</p><p><img src="https://p.k8s.li/image-20220103202406766.png" alt="Snipaste_2021-12-31_19-28-11"></p><p>ç”±äºè¯»ä¹¦ç¬”è®°çš„ç¯‡å¹…å¤ªé•¿ï¼Œåé¢æœ‰ç©ºçš„è¯æˆ‘ä¼šå’Œå»å¹´çš„ã€Š<a href="https://blog.k8s.li/2020-booklist.html">2020 å¹´è¯»ä¹¦ç¬”è®°å’Œæ€è€ƒ</a>ã€‹ä¸€æ ·ï¼Œå†å†™ä¸€ç¯‡ 2021 å¹´çš„è¯»ä¹¦ç¬”è®°æ¥åˆ†äº«ç»™å¤§å®¶ï¼ˆå¤§æ¦‚ç‡æ˜¯åœ¨æ˜¥èŠ‚æœŸé—´å†™äº†ï¼‰ã€‚</p><h2 id="å·¥ä½œ"><a href="#å·¥ä½œ" class="headerlink" title="å·¥ä½œ"></a>å·¥ä½œ</h2><h3 id="å­—èŠ‚è·³åŠ¨"><a href="#å­—èŠ‚è·³åŠ¨" class="headerlink" title="å­—èŠ‚è·³åŠ¨"></a>å­—èŠ‚è·³åŠ¨</h3><p>ä»Šå¹´æœ€å¤§çš„å˜åŒ–å°±æ˜¯æ¢äº†æ–°å·¥ä½œï¼Œè¿™ä¹Ÿæ˜¯ç¬¬äºŒæ¬¡æ¢å·¥ä½œã€‚æœ¬æ¥æ²¡æœ‰æ‰“ç®—ç¦»èŒï¼Œä½†æ˜¯è¢«è¿«<del>å­—èŠ‚</del>è·³åŠ¨äº†ä¸€å¹´ä¹‹åï¼Œæ„Ÿè§‰å¤ªç´¯äº†ï¼Œå¹¶æ²¡æœ‰æƒ³è±¡ä¸­çš„é‚£ä¹ˆå¿«ä¹ã€‚</p><p>ä¸å¾—ä¸åæ§½ä¸€ä¸‹å­—èŠ‚çš„åŸºç¡€è®¾æ–½åšçš„å®åœ¨æ˜¯å¤ªçƒ‚äº†ï¼Œæ¯”å¦‚é•œåƒä»“åº“å„ç§å¥‡è‘©çš„é—®é¢˜ã€‚å½“æ—¶è¿˜å› ä¸ºè¿™ç ´ç©æ„å„¿å‡ºè¿‡ç‰ˆæœ¬å‘å¸ƒçš„é”™è¯¯ï¼Œå¯¼è‡´ç»„ä»¶ç¼–è¯‘çš„ base é•œåƒå‡ºé”™ï¼Œåæ¥åˆä¸å¾—ä¸é‡æ–°å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬æ¥æ“¦å±è‚¡ã€‚</p><p>è¿˜æœ‰å½“æ—¶ PaaS å®¹å™¨äº‘å¹³å°ç§æœ‰åŒ–äº§å“ç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œé¢†å¯¼éå¾—å°†æ‰“åŒ…å‘å¸ƒçš„æ—¶é—´ç‚¹å®šåœ¨ä¸´è¿‘æ™šä¸Šä¸‹ç­çš„æ—¶å€™ã€‚è¿™å°±ä¼šå¯¼è‡´æˆ‘ä»¬ç»„ï¼ˆè‹¦å‘½å‘ç‰ˆå·¥å…·äººï¼‰å¿™æ´»åˆ°æ™šä¸Šåä¸€äºŒç‚¹ï¼ŒçœŸçš„æ˜¯ååˆ†ä¸çˆ½ã€‚å°±æ˜¯å› ä¸ºä¸€äº›å…¬å…±äº‹åŠ¡æ²¡æœ‰åšå¥½ï¼Œä¸€äº›é—®é¢˜åœ¨ç»„ä»¶è‡ªèº«çš„ CI&#x2F;CD æµæ°´çº¿ä¸­å¹¶ä¸èƒ½åŠæ—¶æš´éœ²ï¼Œç­‰åˆ°æœ€ç»ˆæœ€åç‰ˆæœ¬å‘å¸ƒçš„æ—¶å€™ï¼Œå„ç§å¥‡è‘©çš„é—®é¢˜çªçªçªåœ°å†’å‡ºæ¥ã€‚æ¯”å¦‚ç¼ºé•œåƒã€é•œåƒé”™è¯¯ã€helm chart é”™è¯¯ã€ç‰ˆæœ¬é”™è¯¯ç­‰ã€‚ç„¶åå‡ºäº†é—®é¢˜ä¹‹ååˆè¦ @ å„ä¸ªç»„ä»¶çš„ owner å»è§£å†³é—®é¢˜ï¼Œå®ƒä»¬ä¿®æ”¹å¥½ä¹‹åæˆ‘ä»¬å†é‡æ–°æ‰“åŒ…éƒ¨ç½²æ–°çš„ç¯å¢ƒæ¥éªŒè¯ã€‚æ¯åˆ°å‘ç‰ˆæ—¥å°±ååˆ†ç—›è‹¦ï¼Œä¸€äº›åŸºç¡€è®¾æ–½å’Œå…¬å…±äº‹åŠ¡æ²¡æœ‰åšå¥½ï¼Œç­‰åˆ°æœ€åæˆ‘ä»¬å‘ç‰ˆå·¥å…·äººæ¥æ“¦å±è‚¡ã€‚è¿™è®©æˆ‘æƒ³èµ·äº†å¦ä¸€ä½æ¨å‹åˆ†äº«çš„ç»å†ï¼š</p><p><img src="https://p.k8s.li/image-20220104082135898.png" alt="image-20220104082135898"></p><h3 id="è£¸è¾ç¦»èŒ"><a href="#è£¸è¾ç¦»èŒ" class="headerlink" title="è£¸è¾ç¦»èŒ"></a>è£¸è¾ç¦»èŒ</h3><p>å››æœˆåº•å’Œ leader ç»©æ•ˆæ²Ÿé€šå®Œåæ„Ÿè§‰ä¸å¤ªæ»¡æ„äºæ˜¯å†…å¿ƒå°±å†³å®šäº†è¦ç¦»èŒã€‚ä¸è¿‡å› ä¸ºå½“æ—¶ä¸€äº›ç»„ç»‡æ¶æ„çš„è°ƒæ•´ï¼Œæˆ‘æ‰€åšçš„å·¥ä½œæ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„äººæ¥æ¥ç›˜ã€‚å†åŠ ä¸Šæ–°äº§å“åˆšè¿›å…¥è®¾è®¡é˜¶æ®µï¼Œæ–°äº§å“å¹³å°åº•å±‚çš„ K8s éƒ¨ç½²ä»¥åŠç§æœ‰åŒ–æ‰“åŒ…å‘å¸ƒç›¸å…³çš„å·¥ä½œæ²¡æœ‰å…¶ä»–äººèƒ½å¤Ÿ take èµ·æ¥ï¼Œæœ€å°´å°¬çš„æ˜¯è¿™éƒ¨åˆ†å·¥ä½œå½“æ—¶åªæœ‰æˆ‘ä¸€ä¸ªäººèƒ½å®Œæ•´åœ°åšå‡ºæ¥ã€‚å¦‚æœåœ¨äº”æœˆåº•ç¦»èŒçš„è¯ï¼Œå¯èƒ½ä¼šå¯¹æ–°äº§å“çš„å¼€å‘å¸¦æ¥ä¸€å®šå½±å“ã€‚å› æ­¤å½“æ—¶è€ƒè™‘äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯ç­‰åˆ°æ–°äº§å“ç¨³å®šå‘ç‰ˆä»¥åŠæŠŠè´Ÿè´£çš„å·¥ä½œäº¤æ¥ç»™æ–°äººä¹‹åå†ç¦»å¼€å§ã€‚</p><p>å°±è¿™æ ·è‡ªå·±ä¸€ä¸ªäººåˆé‡æ–°è´Ÿè´£èµ·äº†æ•´ä¸ª PaaS å¹³å°çš„ç§æœ‰åŒ–éƒ¨ç½²å’Œæ‰“åŒ…å‘å¸ƒç›¸å…³çš„å·¥ä½œï¼Œè¿™æ®µæ—¶é—´ä¹Ÿæ”¶è·æŒºå¤šçš„ï¼Œé¡ºä¾¿ç»™ kubernetes-sig ç¤¾åŒºçš„ kubespray é¡¹ç›®è´¡çŒ®äº†åå‡ ä¸ª <a href="https://github.com/kubernetes-sigs/kubespray/pulls?q=is:pr+author:muzi502+is:closed">PR</a>ã€‚ç­‰åˆ°ä¸ƒæœˆåº•çš„æ—¶å€™ï¼Œæ–°äº§å“å·²ç»è¿›å…¥äº†ç¨³å®šå¼€å‘çš„é˜¶æ®µï¼Œåœ¨ç¬¬ä¸€ä¸ª alpha.1 ç‰ˆæœ¬æ—¶å°±æå®šäº†ç§æœ‰åŒ–éƒ¨ç½²å’Œç§æœ‰åŒ–æ‰“åŒ…çš„æµæ°´çº¿ï¼Œåˆç»è¿‡ä¸‰ä¸ª sprint çš„è¿­ä»£åï¼Œç»ˆäºç¨³å®šäº†ä¸‹æ¥ã€‚ä¹‹åå°±æ•´ç†äº†ä¸€äº›å¹³æ—¶ç§¯ç´¯çš„æ–‡æ¡£ï¼Œäº¤æ¥ç»™äº†å…¶ä»–åŒäº‹ï¼Œç„¶ååŠç†ç¦»èŒæ‰‹ç»­èµ°äººã€‚</p><p>è£¸è¾çš„åŸå› ä¹Ÿæœ‰å¾ˆå¤šï¼šæƒ³èµ°å‡ºå¿ƒç†èˆ’é€‚åœˆï¼Œæ¢ä¸ªç¯å¢ƒèƒ½è®©è‡ªå·±æˆé•¿èµ·æ¥ï¼›å½“æ—¶å¯¹å·¥ä½œä¹Ÿæœ‰äº†ä¸€ç‚¹åŒå€¦ï¼Œæƒ³å¥½å¥½ä¼‘æ¯ä¸€ä¸‹ï¼›å½“æ—¶çš„çŠ¶æ€ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œå¦‚æœé‚£æ—¶å€™å‡†å¤‡é¢è¯•çš„è¯ï¼Œæ„Ÿè§‰æ•ˆæœä¸å¤ªå¥½ï¼›å¾ˆä¹…æ²¡æœ‰å›å®¶äº†ï¼Œæƒ³åœ¨å®¶å¥½å¥½ä¼‘æ¯ä¸€æ®µæ—¶é—´ã€‚å½“æ—¶ä¹Ÿæ²¡æœ‰é€‰æ‹©ä¼‘å‡ï¼Œè€Œæ˜¯å°†æ‰€æœ‰çš„å‡æœŸéƒ½æŠ˜ç®—æˆåŒå€å·¥èµ„äº†ï¼Œæ„Ÿè§‰è¿™æ ·æ›´åˆ’ç®—ä¸€äº›ã€‚å¦‚æœæ˜¯ä¼‘å‡çš„è¯ï¼Œä¿ä¸å‡†åœ¨ä¼‘å‡çš„æ—¶å€™ä»è¦åœ¨é£ä¹¦ä¸Šå¤„ç†ä¸€äº›åŒäº‹çš„é—®é¢˜ã€‚æ„Ÿè§‰è¿™æ ·å°±æŒºçƒ¦äººçš„ï¼Œæ‰€ä»¥å¹²è„†å°±ç›´æ¥èµ°äººï¼Œé£ä¹¦éƒ½æ²¡äº†è¿˜æ€ä¹ˆè”ç³»æˆ‘ã€‚</p><p>ç¦»èŒçš„ç¬¬äºŒå¤©å°±æ”¶æ‹¾è¡Œæå›è€å®¶ï¼Œå› ä¸ºè€çˆ¸çš„ç”Ÿæ—¥å¿«åˆ°äº†ï¼Œä¹Ÿæƒ³å°½å¿«å›å®¶å’Œå®¶äººå›¢èšã€‚</p><p>ä¹‹åå°±ä¸€ç›´åœ¨å®¶åˆ’æ°´æ‘¸é±¼å•¦ï¼ŒæœŸé—´èŠ±äº†ä¸¤å‘¨å·¦å³çš„æ—¶é—´å®Œæˆäº†ä¸¤ä¸ªå¼€æºé¡¹ç›®ï¼šä¸€ä¸ªæ˜¯ç”¨äºæ„å»º yum&#x2F;apt&#x2F;dnf ç¦»çº¿æºçš„å·¥å…· <a href="https://github.com/k8sli/os-packages">k8sli&#x2F;os-packages</a> ï¼Œä»¥åŠæ— ç½‘ç¯å¢ƒä¸­ç¦»çº¿éƒ¨ç½² k8s çš„å·¥å…·  <a href="https://github.com/k8sli/kubeplay">k8sli&#x2F;kubeplay</a> ã€‚</p><h3 id="é¢è¯•"><a href="#é¢è¯•" class="headerlink" title="é¢è¯•"></a>é¢è¯•</h3><p>æ­£å¼å¼€å§‹å‡†å¤‡é¢è¯•æ˜¯åœ¨ 9 æœˆåˆçš„æ—¶å€™ï¼Œå·²ç»åˆ’æ°´æ‘¸é±¼ä¸€ä¸ªæœˆäº†ï¼Œæ„Ÿè§‰ä¼‘æ¯çš„ä¹Ÿå·®ä¸å¤šäº†ã€‚è¿˜æ˜¯èµ¶ç´§æ‰¾å·¥ä½œé¢è¯•å§ï¼Œåœ¨èµ·åˆçš„ä¸€å‘¨æ˜¯é€šè¿‡ä¸€äº›å¿ƒä»ªå…¬å¸çš„å®˜ç½‘ä¸ŠæŠ•é€’çš„ç®€å†ï¼Œä¸å¹¸çš„æ˜¯æ”¶åˆ°çš„å›å¤å¾ˆå°‘ã€‚å½“æ—¶å¿ƒé‡Œæœ‰ç‚¹æ…Œï¼Œå†™äº†ç¯‡æ±‚èŒã€Š<a href="https://blog.k8s.li/jobs.html">æ±‚èŒè´´ï¼šè¿ç»´å¼€å‘ ï½œSRE</a>ã€‹ä»‹ç»äº†ä¸€ä¸‹è‡ªå·±çš„ç°çŠ¶ï¼Œç»ˆäºæ”¶åˆ°äº†ä¸€äº›å°ä¼™ä¼´ä»¬çš„å†…æ¨ã€‚</p><p><img src="https://p.k8s.li/image-20211231205927088.png" alt="image-20211231205927088"></p><p>åœ¨æ­¤è¿˜æ˜¯ååˆ†æ„Ÿè°¢å¸®åŠ©æˆ‘å†…æ¨çš„å°ä¼™ä¼´ï¼Œåœ¨æˆ‘å³å°†èµ°æŠ•æ— è·¯çš„æ—¶å€™æœ‰ä½ ä»¬çš„æ¨èæ‰æœ‰äº†æˆ‘ç°åœ¨çš„å·¥ä½œæœºä¼šã€‚å¤§å¤§å°å°çš„é¢è¯•æ€»å…±è¿›è¡Œäº† 25 æ¬¡å§ï¼Œå·®ä¸å¤šé€šè¿‡äº†ä¸€åŠï¼Œæ‹¿åˆ° 4 ä¸ªä¹¦é¢ offerï¼Œæœ€ç»ˆå»äº†ä¸€å®¶åš IaaS è™šæ‹ŸåŒ–å’Œåˆ†å¸ƒå¼å—å­˜å‚¨äº§å“çš„ toB å…¬å¸ã€‚</p><p>å› ä¸ºä¹‹å‰æ˜¯åœ¨å­—èŠ‚è·³åŠ¨åš PaaS toB äº§å“çš„é›†ç¾¤éƒ¨ç½²å’Œç§æœ‰åŒ–äº¤ä»˜ç›¸å…³å·¥ä½œï¼Œåœ¨æ–°å·¥ä½œåˆ™æ˜¯åš IaaS toB äº§å“çš„é›†ç¾¤éƒ¨ç½²ç›¸å…³å·¥ä½œï¼Œéƒ½æ˜¯â€œé›†ç¾¤éƒ¨ç½²â€ç›¸å…³çš„ï¼Œå› æ­¤å’Œä»¥å¾€çš„ç»å†æ¯”è¾ƒåŒ¹é…ã€‚å¯¹äºåƒå’±è¿™ç§å–œæ¬¢æŠ˜è…¾çš„åƒåœ¾ä½¬æ¥è¯´ï¼Œè¿˜æ˜¯ç¡¬ä»¶æœåŠ¡å™¨ã€æ“ä½œç³»ç»Ÿã€è™šæ‹ŸåŒ–ã€åˆ†å¸ƒå¼å­˜å‚¨ç­‰æ–¹é¢çš„å†…å®¹æ¯”è¾ƒæœ‰æ„æ€ï¼Œç©èµ·æ¥å¯å¼€å¿ƒæƒ¹ ğŸ¤£ã€‚</p><p>æ›´ä¸ºé‡è¦çš„ä¸€ç‚¹æ˜¯æ–°å·¥ä½œä¸å†åƒä»¥å‰é‚£æ ·è¿ç»´æŠ€æœ¯ä¸ºä¸»äº†ï¼Œè€Œè‡³ä»¥åç«¯ç ”å‘ä¸ºä¸»ã€‚å…¶å®æˆ‘å¾ˆæ—©ä¹‹å‰å°±æƒ³å†™ä¸€äº› Go&#x2F;Python åç«¯é¡¹ç›®çš„ä»£ç äº†ï¼Œåªä¸è¿‡ä¸€ç›´æ²¡æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æœºä¼šï¼ˆå…¶å®æ˜¯å·æ‡’çš„å€Ÿå£ ğŸŒšï¼‰ã€‚åœ¨å­—èŠ‚çš„æ—¶å€™ä¹Ÿæ²¡æœ‰å¤ªå¤šåç«¯å¼€å‘çš„ç»éªŒï¼Œæ‰€ä»¥å½“åˆé¢è¯•çš„æ—¶å€™å› ä¸ºå¼€å‘èƒ½åŠ›è¾ƒå¼±è¢«åˆ·æ‰äº†å¾ˆå¤šï¼Œä¹Ÿè®©ä¸€äº›é¢è¯•å®˜æå…¶å¤±æœ›ã€‚</p><p>å¹¸è¿çš„æ˜¯é¢è¯•çš„æ—¶å€™ä¹Ÿé‡åˆ°äº†ä¸€ä¸ªéå¸¸ nice çš„å…¬å¸æ„¿æ„èŠ±æ—¶é—´åŸ¹å…»æˆ‘è¿™æ–¹é¢çš„èƒ½åŠ›ï¼Œleader ä¹Ÿååˆ†ä¿¡ä»»æˆ‘çš„å­¦ä¹ èƒ½åŠ›ï¼Œè®©æˆ‘ä»é›¶å¼€å§‹æ‰¿æ‹…ä¸€ä¸ªé¡¹ç›®çš„åç«¯å¼€å‘ï¼Œç»™äº†æˆ‘è¿™ä¹ˆä¸€ä¸ªå®è´µçš„æœºä¼šæ¥å­¦ä¹ å’Œå¼¥è¡¥å¼€å‘èƒ½åŠ›ä¸è¶³çš„çŸ­æ¿ã€‚</p><h2 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h2><p>ç”Ÿæ´»ä¸Šä¾æ—§æ˜¯å•èº«ç‹¬å±…ï¼Œè‡ªå·±ä¸€ä¸ªäººç”Ÿæ´»å®åœ¨æ˜¯å¤ªçˆ½äº†ï¼Œè¶Šæ¥è¶Šä¹ æƒ¯è¿™ç§ç”Ÿæ´»ï¼Œå¥½æƒ³æ°¸è¿œåœ°å°±è¿™æ ·ç”Ÿæ´»ä¸‹å»ï¼Œæ²¡æœ‰å‚¬å©šçš„çƒ¦æ¼ ğŸ˜–ã€‚ç‹¬è‡ªä¸€ä¸ªäººç”Ÿæ´»æœ€é‡è¦çš„å°±æ˜¯å­¦ä¼š<strong>å¦‚ä½•å¯¹æŠ—è™šæ— </strong>ã€‚åªè¦æ‰¾äº›æœ‰æ„ä¹‰çš„äº‹æƒ…æ¥åšï¼ˆæ¯”å¦‚è¯»ä¹¦ï¼‰ï¼Œå°±ä¸ä¼šè§‰ç€ç”Ÿæ´»æ— å‘³æˆ–è€…æœ‰ç©ºè™šæ„Ÿã€‚å›æƒ³èµ·å¤§å­¦å››å¹´ï¼ŒåŸºæœ¬ä¸Šæˆ‘ä¹Ÿæ˜¯çš„ç‹¬è‡ªä¸€äººå»å›¾ä¹¦é¦†çœ‹ä¹¦ã€ç‹¬è‡ªä¸€äººåƒé¥­ã€ç‹¬è‡ªä¸€äººå»è‡ªä¹ å®¤ï¼Œæ„Ÿè§‰å’Œç°åœ¨æ²¡æœ‰å¤ªå¤šå·®åˆ«ï¼Œåªä¸è¿‡ä»ä¸Šè¯¾å­¦ä¹ æ¢æˆäº†å·¥ä½œæ¬ç –ï¼Œå…¶ä»–æ—¶é—´çš„ç”Ÿæ´»èŠ‚å¥åŸºæœ¬ä¸Šæ²¡æœ‰å¤ªå¤§çš„å˜åŒ–ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹å°±æ˜¯å°½é‡çš„è¿œç¦»ç¤¾äº¤åª’ä½“ï¼Œä¸è¦è¿‡åº¦åœ°ä¾èµ–å®ƒä»¬ï¼Œæ›´ä¸è¦æ”¾çºµè‡ªå·±ä¸åœåœ°åˆ·æ¨æˆ–è€…çŸ­è§†é¢‘æ¥å¨±ä¹æ¶ˆé£ã€‚å…¶å®è¿™äº›ä¸œè¥¿å¹¶ä¸èƒ½ç»™æˆ‘ä»¬å¸¦æ¥çœŸæ­£æ„ä¹‰ä¸Šçš„å¿«ä¹ï¼Œæœ‰ä¸€éƒ¨çºªå½•ç‰‡ã€Š<a href="https://www.netflix.com/sg-zh/title/81254224">ç›‘è§†èµ„æœ¬ä¸»ä¹‰ï¼šæ™ºèƒ½é™·é˜±</a>ã€‹é‡Œé¢ä¹Ÿè°ˆåˆ°è¿‡è¿‡åº¦ä¾èµ–ç¤¾äº¤åª’ä½“çš„åæœã€‚</p><h3 id="æ­å·è¿‡å¹´"><a href="#æ­å·è¿‡å¹´" class="headerlink" title="æ­å·è¿‡å¹´"></a>æ­å·è¿‡å¹´</h3><p>å› ä¸ºç–«æƒ…çš„åŸå›  2021 å¹´å°±æ²¡å›å®¶è¿‡å¹´ï¼Œå†åŠ ä¸Šè¶Šæ˜¯å†œæ‘é‚£ç§ç ´åœ°æ–¹é˜²ç–«æªæ–½å°±æ˜¯è¶Šç¦»è°±ï¼Œçœ‹çœ‹ç°åœ¨è¥¿å®‰çš„é˜²ç–«æªæ–½ä½ ä»¬å°±èƒ½æ˜ç™½äº†ä¸ºä»€ä¹ˆä¸æƒ³å›å®¶ã€‚äºæ˜¯å°±æ‡’å¾—æŠ˜è…¾ï¼Œé€‰æ‹©ç‹¬è‡ªä¸€äººç•™åœ¨æ­å·è¿‡å¹´ï¼Œé¡ºä¾¿è¿˜èƒ½é¢†å–æ­å·å¸‚æ”¿åºœçš„ç•™æ­è¡¥è´´ 1000 å—é’±ã€‚æ­å·å¸‚åœ¨è¿™ä¸€å—åšçš„è¿˜çœŸä¸é”™ï¼Œå»å¹´è¿˜é¢†äº†äººæ‰è¡¥è´´çš„ 1w å—é’±ï¼Œä»è€å¤§å“¥æ‰‹é‡Œè–…ç¾Šæ¯›ï¼ŒçœŸé¸¡å„¿åˆºæ¿€ã€‚</p><h3 id="ç¯å¤ªæ¹–éª‘è¡Œ"><a href="#ç¯å¤ªæ¹–éª‘è¡Œ" class="headerlink" title="ç¯å¤ªæ¹–éª‘è¡Œ"></a>ç¯å¤ªæ¹–éª‘è¡Œ</h3><p>ä¸ºäº†ä¸è®©äº”ä¸€å‡æœŸå†åƒè¿‡å¹´é‚£æ ·ä¸€ç›´çƒ‚åœ¨å®¶é‡Œï¼Œå°±ç‹¬è‡ªä¸€äººä»æ­å·éª‘è¡Œåˆ°æ¹–å·ã€å¸¸å·ã€æ— é”¡ã€è‹å·ã€å¤ªæ¹–ä¸€å¸¦æ¸¸ç©ï¼ŒçœŸçš„æ˜¯å¾ˆä¹…æ²¡æœ‰é‚£ä¹ˆå¼€å¿ƒè¿‡äº†ã€‚å›æ¥ä¹‹åè¿˜æ›´æ–°äº†ä¸€ç¯‡åšå®¢ã€Š<a href="https://blog.k8s.li/taihu.html">äº”ä¸€å‡æœŸç¯å¤ªæ¹–éª‘è¡Œä¹‹æ—…</a>ã€‹ï¼Œæ—…ç¨‹çš„é£æ™¯çœŸçš„ä¸é”™ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥å»è¯»ä¸€ä¸‹ã€‚</p><h3 id="ä¸Šæµ·ç§Ÿæˆ¿"><a href="#ä¸Šæµ·ç§Ÿæˆ¿" class="headerlink" title="ä¸Šæµ·ç§Ÿæˆ¿"></a>ä¸Šæµ·ç§Ÿæˆ¿</h3><p>æ–°å·¥ä½œçš„åŠå…¬åœ°ç‚¹æ˜¯åœ¨ä¸Šæµ·ï¼Œå› ä¸ºä¸æ”¯æŒè¿œç¨‹åŠå…¬æ‰€ä»¥ä¸å¾—ä¸ä»æ­å·æ¬å®¶æ¥åˆ°ä¸Šæµ·ã€‚åœ¨ä¸­ä»‹è€å“¥çš„å¸¦é¢†ä¸‹æ‰¾äº†ä¸€ä¸ªæœˆç§Ÿ 3100 å…ƒçš„å§å®¤ + ç‹¬å«çš„æˆ¿å­ï¼ˆåŒ…æ°´ç”µè´¹ï¼‰ï¼Œæ•´ä½“æ„Ÿè§‰ååˆ†æ»¡æ„ã€‚æˆ¿å­æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ä¸‰å®¤ä¸€å…ã€‚æˆ‘ä½åœ¨å…¶ä¸­çš„ä¸€ä¸ªå¤§å§å®¤ï¼Œæˆ¿ä¸œä»–çˆ¶æ¯ä½åœ¨å¦ä¸€ä¸ªå§å®¤ï¼Œå‰©ä½™çš„ä¸€ä¸ªå§å®¤æ˜¯ç©ºç€çš„ï¼Œé™¤äº†æˆ‘ä»¥å¤–æ²¡æœ‰å…¶ä»–çš„ç§Ÿå®¢ã€‚å‡ºäºå¯¹è€äººå®‰å…¨çš„è€ƒè™‘ï¼Œæˆ¿ä¸œåªå…è®¸æˆ‘è‡ªå·±ä¸€ä¸ªäººä½ï¼Œä¸èƒ½å¸¦å¤–äººæ¥ã€‚å¯¹æˆ‘æ¥è¯´ä¹Ÿæ²¡å•¥ï¼Œç‹¬æ¥ç‹¬å¾€çš„ç”Ÿæ´»åæ­£ä¹Ÿä¸ä¼šæœ‰å…¶ä»–äººæ¥æ‰¾æˆ‘ç©å„¿ã€‚</p><p>å§å®¤é¢ç§¯ 3.3 * 4.3m&#x3D;14.19 å¹³ã€ç„å…³ 1.1 * 1m&#x3D;1.1 å¹³ã€å«ç”Ÿé—´ 2.3 * 2.1m&#x3D;4.38 å¹³ã€‚åŠ èµ·æ¥æ€»å…±å·®ä¸å¤š 20 å¹³ã€‚æ„Ÿè§‰è¿™ä¸ªé¢ç§¯æ„Ÿè§‰æ¯”æ­å·é‚£ä¸ªå¸¦é˜³å°çš„å§å®¤å¤§å¾ˆå¤šã€‚ä¸€ä¸ª 1.5 * 2m çš„åºŠã€é å¢™å†æ”¾ç½®ä¸¤å¼  60* 120 cm çš„å®œå®¶æ¡Œå­ã€åºŠçš„å³ä¾§åˆèƒ½æ”¾ä¸‹ä¸€å¼  0.6 * 1.4m ç±³çš„ä¹¦æ¡Œï¼Œè¿˜æœ‰ä¸€ä¸ª 0.5 *2m çš„è¡£æŸœã€‚</p><p>ç°åœ¨ç»ˆäºä½ä¸Šäº†è‡ªå·±æ‰€æœŸå¾…çš„é‚£ç§æˆ¿å­ï¼Œå›æƒ³èµ·å¤§å­¦åˆšæ¯•ä¸šé‚£ä¸€å¹´ä½çš„è¿˜æ˜¯ 300 å—é’±çš„ä¸Šä¸‹é“ºé’æ—…ï¼Œå°±æ„Ÿè§‰å½“æ—¶ååˆ†å¯’é…¸ ğŸ˜­ã€‚</p><p><img src="https://p.k8s.li/image-20220103165850671.png" alt="image-20220103165850671"></p><p>æˆ¿é—´é‡Œè¿˜æœ‰ä¸€ä¸ªå¸¦ä¹¦æ¶çš„ç”µè„‘æ¡Œï¼Œæ”¾ä¸‹ä¸€ä¸ª 27 å¯¸çš„æ˜¾ç¤ºå™¨åˆšåˆšå¥½ã€‚å¦å¤–æŠŠæˆ‘é‚£å° HPE Gen10 Plus æœåŠ¡å™¨å®‰ç½®åœ¨äº†ä¹¦æ¡Œä¸‹é¢ã€‚è™½ç„¶é è¿‘åºŠå¤´ï¼Œä½† NAS é‡Œç¡¬ç›˜çš„å™ªéŸ³è¿˜ç®—èƒ½æ¥å—ï¼Œä¸è‡³äºåµå¾—ç¡ä¸ç€è§‰ã€‚æœ‰æ—¶å€™åœ¨æƒ³è¦ä¸è¦æ•´ä¸ª 12U çš„æœºæŸœæ¥ç€ï¼Œä½†è§„åˆ’äº†ä¸€ä¸‹æ„Ÿè§‰è¿˜æ˜¯æ²¡æœ‰å¤ªå¤§çš„å¿…è¦ï¼Œå…ˆè¿™æ ·å‡‘æ´»ç€ç”¨å§ã€‚</p><p><img src="https://p.k8s.li/image-20220103202406765.jpg" alt="IMG_2177"></p><p>æ¬è¿›æ¥ä¹‹åçš„ç¬¬äºŒå¤©åœ¨é—²é±¼ä¸ŠèŠ±äº† 300 å—é’±æ¡æ¥äº†ä¸€ä¸ªåŸä»· 1699 çš„ç±³å®¶æ‰«åœ°æœºå™¨äººï¼ŒåˆèŠ±äº† 200 å—é’±æ¡äº†ä¸€ä¸ªç±³å®¶ç©ºæ°”å‡€åŒ–å™¨ï¼ˆè´«ç©·å¦‚æˆ‘ï¼Œåªèƒ½é æ¡å’Œè–…æ¥æå‡ç”Ÿæ´»å¹¸ç¦æ„Ÿäº†ï¼‰ã€‚æ„Ÿè§‰è¿™ä¸¤ä¸ªå®¶ç”¨ç”µå™¨è¿˜æ˜¯æŒºå€¼çš„ï¼Œæ‰«åœ°æœºå™¨äººçœå»äº†æ‰“æ‰«å«ç”Ÿçš„éº»çƒ¦äº‹å„¿ï¼Œç”Ÿæ´»å¹¸ç¦æ„Ÿ +++ã€‚</p><h2 id="2022"><a href="#2022" class="headerlink" title="2022"></a>2022</h2><p>å°±åƒä½œå®¶æ–¹æ–¹æ‰€è¯´çš„é‚£æ ·ï¼š<a href="http://fangfang.blog.caixin.com/archives/220746">æ—¶ä»£çš„ä¸€ç²’ç°ï¼Œè½åœ¨ä¸ªäººå¤´ä¸Šå°±æ˜¯ä¸€åº§å±±</a> ã€‚å¤–å©†åœ¨ 2020 å¹´æ–°å† ç–«æƒ…åˆšçˆ†å‘çš„é‚£æ®µæ—¶é—´ä¸å¹¸ç¦»å¼€äº†è¿™ä¸ªä¸–ç•Œï¼Œè€Œé‚£æ®µæ—¶é—´çš„ç»å†ä¹Ÿå½»åº•æ”¹å˜äº†æˆ‘çœ‹å¾…ç”Ÿæ­»çš„æƒ³æ³•ã€‚ä»¿ä½›ä¸€åˆ‡éƒ½æ²¡æœ‰é‚£ä¹ˆé‡è¦äº†ï¼Œä¹Ÿè®©æˆ‘æ·±åˆ»åœ°æ˜ç™½äº†<strong>è¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿æ— æ³•ä¸èƒ½å¤±å»çš„ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆéå¾—å¿…é¡»è¦å¾—åˆ°çš„</strong>ã€‚å³ä¾¿æ˜¯æŸä¸€å¤©æˆ‘ä¸å¹¸å»ä¸–ï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šé—æ†¾å’Œæ‚”æ¨ã€‚æ‰€ä»¥å»ä»–çš„æœªæ¥è®¡åˆ’ï¼Œå’Œå¾€å¸¸ä¸€æ ·å¥½å¥½æ¬ç –å·¥ä½œå’Œçœ‹ä¹¦å­¦ä¹ ï¼Œè¿™æ ·å°±å¤Ÿäº†ã€‚</p><p>å¦å¤–ç¥å¤§å®¶æ–°çš„ä¸€å¹´å¿«å¿«ä¹ä¹ ğŸ¥³</p>]]></content>
    
    <summary type="html">
    
      
      
        
        
          &lt;p&gt;2021
        
      
    
    </summary>
    
    
    
  </entry>
  
</feed>
